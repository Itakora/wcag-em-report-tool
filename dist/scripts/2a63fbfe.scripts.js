"use strict";angular.module("wcagReporter",["ngResource","ngSanitize","ngRoute","ngAnimate","pascalprecht.translate","wert-templates"]).config(["$routeProvider","$compileProvider",function(a,b){b.aHrefSanitizationWhitelist(/^\s*(https?|data|blob):/),a.when("/",{templateUrl:"views/start.html",controller:"StartCtrl"}).when("/evaluation/scope",{templateUrl:"views/evaluation/scope.html",controller:"EvalScopeCtrl"}).when("/evaluation/explore",{templateUrl:"views/evaluation/explore.html",controller:"EvalExploreCtrl"}).when("/evaluation/sample",{templateUrl:"views/evaluation/sample.html",controller:"EvalSampleCtrl"}).when("/evaluation/audit",{templateUrl:"views/evaluation/audit.html",controller:"EvalAuditCtrl"}).when("/evaluation/report",{templateUrl:"views/evaluation/report.html",controller:"EvalReportCtrl"}).when("/view_report",{templateUrl:"views/viewReport.html",controller:"ViewReportCtrl"}).when("/open",{templateUrl:"views/open.html",controller:"OpenCtrl"}).when("/save",{templateUrl:"views/save.html",controller:"SaveCtrl"}).when("/error",{templateUrl:"views/error.html"}).otherwise({redirectTo:"/error"})}]),angular.module("wcagReporter").value("supportedLanguages",[{code:"en",localName:"English"},{code:"nl",localName:"Nederlands"}]).config(["$translateProvider","wcag2specProvider",function(a,b){function c(a,b){document.cookie=a+"="+b+"; path=/"}function d(a){for(var b=a+"=",c=document.cookie.split(";"),d=0;d<c.length;d++){for(var e=c[d];" "==e.charAt(0);)e=e.substring(1,e.length);if(0==e.indexOf(b))return e.substring(b.length,e.length)}return null}var e;try{e=d("wcagReporter-lang"),e||(e=jQuery('*[ng-app="wcagReporter"]').attr("lang")||"en",e=e.substr(0,2),c("wcagReporter-lang",e))}catch(f){e="en"}a.useSanitizeValueStrategy(null),a.useStaticFilesLoader({prefix:"locale/",suffix:".json"}),b.setSpecPath("wcag2spec/wcag2-${lang}.json"),b.loadLanguage(e),a.preferredLanguage(e)}]).run(["$rootScope","$rootElement","$route","translateFilter",function(a,b,c,d){a.translate=d,b.addClass("app-loading"),a.$on("$translateChangeSuccess",function(c,d){b.attr("lang",d.language),a.lang=d.language,b.removeClass("app-loading")})}]),angular.module("wcagReporter").run(["$rootScope","$document","$rootElement","evalScopeModel",function(a,b,c,d){var e,f=b.find("title"),g=f.text().trim();g&&(g=f.text()+", "),a.focusH1=function(){var a=c.find("h1:first()").attr({tabindex:-1,role:"heading"});setTimeout(function(){a.focus()},10)},a.setTitle=function(b){var c="";return d.website&&d.website.title&&(c=d.website.title+" - "),f.text(g+c+b),e===!0&&(e=!1,setTimeout(a.focusH1,750)),b},a.$on("$routeChangeSuccess",function(){e=void 0!==e,document.activeElement&&document.activeElement.blur()})}]).run(["$rootScope","appState","$location",function(a,b,c){a.rootHide={},b.init(),a.setEvalLocation=function(){b.setDirtyState(),c.path("/evaluation/scope")},a.support={hasSupport:b.hasBrowserSupport(),hideMessage:!1}}]).run(["$rootElement","wcagReporterExport","showSave","appState",function(a,b,c,d){c&&a.on("keydown",function(a){83===a.keyCode&&(a.ctrlKey||a.metaKey)&&(c(b.getString(),b.getFileName(),"application/json"),d.setPrestineState(),a.preventDefault())});var e=new RegExp("/"+window.location.host+"/");a.on("click","a[href]:not(.local)",function(a){e.test(this.href)||"http"!==this.href.substr(0,4)||(a.preventDefault(),a.stopPropagation(),window.open(this.href,"_blank"))})}]).run(["wcagReporterImport","wcagReporterExport","$rootElement",function(a,b,c){b.storage.init({autosave:"string"==typeof c.attr("autosave"),url:c.attr("url"),saveDelay:c.attr("save-delay")||1500}),c.attr("url")&&a.getFromUrl()}]),angular.module("wcagReporter").value("pkgData",{name:"WCAG-EM-Report-Tool",version:"1.1.0-preview"}),angular.module("wcagReporter").value("toggleCriterionText",function(a){var b=-1!==[!0,"true"].indexOf(a.getAttribute("aria-expanded"));a.setAttribute("aria-expanded",!b);var c=a.parentNode.parentNode.nextSibling;c.classList.toggle("collapsed")}),angular.module("wcagReporter").factory("directivePlugin",function(){var a=function(a){var b=a.link||function(){};return a.plugins||(a.plugins=[]),a.link=function(){var c=arguments;b.apply(void 0,c),a.plugins.forEach(function(a){a.link&&a.link.apply(void 0,c)})},a};return a}),angular.module("wcagReporter").service("changeLanguage",["$translate","wcag2spec","$rootScope",function(a,b,c){function d(a,b){document.cookie=a+"="+b+"; path=/"}return function(e){c.lang!==e&&(document&&d("wcagReporter-lang",e),a.use(e),b.loadLanguage(e))}}]),angular.module("wcagReporter").value("evalContextV1",{"@vocab":"http://www.w3.org/TR/WCAG-EM/#",wcag20:"http://www.w3.org/TR/WCAG20/#",earl:"http://www.w3.org/ns/earl#",dct:"http://purl.org/dc/terms/",reporter:"https://github.com/w3c/wcag-em-report-tool/blob/master/dataformat.md#",conformanceTarget:{id:"step1b",type:"id"},evaluationScope:{id:"step1"},accessibilitySupportBaseline:{id:"step1c"},additionalEvalRequirement:{id:"step1d"},siteScope:{id:"step1a"},commonPages:{id:"step2a"},essentialFunctionality:{id:"step2b"},pageTypeVariety:{id:"step2c"},otherRelevantPages:{id:"step2e"},structuredSample:{id:"step3a"},randomSample:{id:"step3b"},specifics:{id:"step5b"},auditResult:{id:"step4"},outcome:{type:"id"},subject:{type:"id"},assertedBy:{type:"id"},testRequirement:{type:"id"},creator:{type:"id"},handle:"reporter:handle",description:"reporter:description",tested:"reporter:tested",id:"@id",type:"@type",title:"dct:title",hasPart:"dct:hasPart",specs:"@id",reliedUponTechnology:"wcag20:reliedupondef"}),angular.module("wcagReporter").value("evalContextV2",{"@vocab":"http://www.w3.org/TR/WCAG-EM/#",reporter:"https://github.com/w3c/wcag-em-report-tool/",wcagem:"http://www.w3.org/TR/WCAG-EM/#",WCAG2:"http://www.w3.org/TR/WCAG20/#",earl:"http://www.w3.org/ns/earl#",dct:"http://purl.org/dc/terms/",wai:"http://www.w3.org/WAI/",sch:"https://schema.org/",Evaluation:"wcagem:Evaluation",EvaluationScope:"wcagem:EvaluationScope",TestSubject:"earl:TestSubject",WebSite:"sch:WebSite",Sample:"wcagem:Sample",WebPage:"sch:WebPage",Technology:"WCAG2:technologydef",Assertion:"earl:Assertion",Assertor:"earl:Assertor",TestResult:"earl:TestResult",title:"dct:title",summary:"dct:summary",creator:{"@id":"dct:creator","@type":"@id"},date:"dct:date",commissioner:"wcagem:commissioner",reliedUponTechnology:"WCAG2:reliedupondef",evaluationScope:"step1",commonPages:"step2a",essentialFunctionality:"step2b",pageTypeVariety:"step2c",otherRelevantPages:"step2e",structuredSample:"step3a",randomSample:"step3b",auditResult:"step4",specifics:"step5b",publisher:{"@id":"dct:publisher","@type":"@id"},conformanceTarget:{"@id":"step1b","@type":"@id"},accessibilitySupportBaseline:"step1c",additionalEvalRequirement:"step1d",website:"WCAG2:set-of-web-pagesdef",siteScope:"step1a",siteName:"sch:name",webpage:"WCAG2:webpagedef",description:"dct:description",source:{"@id":"dct:source","@type":"@id"},tested:"reporter:blob/master/docs/EARL%2BJSON-LD.md#tested",test:{"@id":"earl:test","@type":"@id"},assertedBy:{"@id":"earl:assertedBy","@type":"@id"},subject:{"@id":"earl:subject","@type":"@id"},result:"earl:result",mode:{"@id":"earl:mode","@type":"@id"},hasPart:"dct:hasPart",outcome:{"@id":"earl:outcome","@type":"@id"},id:"@id",type:"@type",lang:"@language"}),angular.module("wcagReporter").constant("knownTech",[{title:"HTML5",id:"http://www.w3.org/TR/html5/",type:"Technology"},{title:"XHTML 1.0",id:"http://www.w3.org/TR/xhtml1/",type:"Technology"},{title:"HTML 4.01",id:"http://www.w3.org/TR/html401/",type:"Technology"},{title:"CSS",id:"http://www.w3.org/Style/CSS/specs/",type:"Technology"},{title:"WAI-ARIA",id:"http://www.w3.org/TR/wai-aria/",type:"Technology"},{title:"ECMAScript 3",id:"http://www.ecma-international.org/publications/standards/Ecma-327.htm",type:"Technology"},{title:"ECMAScript 5",id:"http://www.ecma-international.org/publications/standards/Ecma-262.htm",type:"Technology"},{title:"DOM",id:"http://www.w3.org/DOM/",type:"Technology"},{title:"Flash",id:"http://get.adobe.com/nl/flashplayer/",type:"Technology"},{title:"Silverlight",id:"http://www.microsoft.com/silverlight/",type:"Technology"},{title:"OOXML",id:"http://www.ecma-international.org/publications/standards/Ecma-376.htm",type:"Technology"},{title:"ODF 1.2",id:"https://www.oasis-open.org/standards#opendocumentv1.2",type:"Technology"},{title:"SVG",id:"http://www.w3.org/TR/SVG/",type:"Technology"}]),angular.module("wcagReporter").service("reportStorage",["$http","$rootScope","appState","$timeout",function(a,b,c,d){function e(){return j.url?void(g=d(function a(){f.exportModel.saveToUrl().then(function(){i=0},function(){i+=1,j.autosave&&(g=d(a,j.saveDelay*i,0,!1))})},j.saveDelay,0,!1)):void(j.autosave=!1)}var f,g,h,i=0,j={url:void 0,revisionId:void 0,autosave:!1,saveDelay:3e3};return b.$on("appstate:prestine",function(){g&&(d.cancel(g),g=void 0)}),b.$on("appstate:dirty",function(){j.autosave&&void 0===g&&e()}),f={settings:j,exportModel:void 0,init:function(a){f.updateSettings(a)},updateSettings:function(a){a&&angular.extend(j,a),j.autosave&&h?h.then(e):j.autosave&&e()},post:function(b){return j.revisionId&&(b._rev=j.revisionId),a.put(j.url,b,{},{withCredentials:!0}).then(function(a){return a&&a.data&&a.data.rev&&(j.revisionId=a.data.rev),c.setPrestineState(),a.data})},get:function(){return d.cancel(g),h=a.get(j.url,{},{withCredentials:!0}).then(function(a){return a.data._rev&&(j.revisionId=a.data._rev),c.setPrestineState(),a.data})}}}]),angular.module("wcagReporter").service("evalLoader",["evalWindow","appState","fileReader","wcagReporterImport","$q",function(a,b,c,d,e){function f(c){var d;return function(){function f(a){h.reject(a),d&&d.abort()}var g=c.apply(null,arguments),h=e.defer();if(b.empty)d=a;else try{d=a.openEmptyWindow()}catch(i){f("Popup blocker detected. Please allow popups so the evaluation can open in a new window.")}return g.then(function(a){try{d.loadJson(a),b.setDirtyState(),h.resolve()}catch(c){f(c)}},f),h.promise}}return{openFromFile:f(function(a){return c.readAsText(a)}),openFromUrl:f(function(){return d.getFromUrl()})}}]),angular.module("wcagReporter").service("evalWindow",["$http","wcagReporterImport","$rootScope",function(a,b,c){function d(){}function e(a){f.loadJson(a),c.setEvalLocation()}var f,g="waitingForEvaluation",h="loadEvaluationData",i="evaluateDataWhenReady";return d.prototype={openEmptyWindow:function(){var a=new d,b=window.open(window.location.href,"_blank");return b[g]=!0,a.abort=function(){b.close()},a.loadJson=function(a){b[h]?b[h](a):b[i]=a},a},loadJson:function(a){b.fromJson(a)},abort:angular.noop},f=new d,window[g]&&(window[g]=void 0,window[i]?e(window[i]):window[h]=e),f}]),function(a){var b=function(a,b){var c=function(a,b,c){return function(){c.$apply(function(){b.resolve(a.result)})}},d=function(a,b,c){return function(){c.$apply(function(){b.reject(a.result)})}},e=function(a,b){return function(a){b.$broadcast("fileProgress",{total:a.total,loaded:a.loaded})}},f=function(a,b){var f=new FileReader;return f.onload=c(f,a,b),f.onerror=d(f,a,b),f.onprogress=e(f,b),f},g=function(c,d){d=d||b;var e=a.defer(),g=f(e,d);return d.$evalAsync(function(){try{g.readAsText(c)}catch(a){e.reject(a)}}),e.promise},h=function(c,d){d=d||b;var e=a.defer(),g=f(e,d);return d.$evalAsync(function(){try{g.readAsDataURL(c)}catch(a){e.reject(a)}}),e.promise};return{readAsDataUrl:h,readAsText:g}};a.factory("fileReader",["$q","$rootScope",b])}(angular.module("wcagReporter")),angular.module("wcagReporter").service("showSave",function(){var a,b="application/octet-stream",c="download"in document.createElement("a"),d=window.Blob,e=window.URL||window.webkitURL||window.mozURL||window.msURL;navigator.saveBlob=navigator.saveBlob||navigator.msSaveBlob||navigator.mozSaveBlob||navigator.webkitSaveBlob,window.saveAs=window.saveAs||window.webkitSaveAs||window.mozSaveAs||window.msSaveAs;var f={"image/jpeg":!0,"image/png":!0,"image/gif":!0,"image/svg+xml":!0,"image/bmp":!0,"image/x-windows-bmp":!0,"image/webp":!0,"audio/wav":!0,"audio/mpeg":!0,"audio/webm":!0,"audio/ogg":!0,"video/mpeg":!0,"video/webm":!0,"video/ogg":!0,"text/plain":!0,"text/html":!0,"text/xml":!0,"application/xhtml+xml":!0,"application/json":!0};return d&&(window.saveAs||navigator.saveBlob)?a=function(a,c,e){var f=new d([a],{type:e||b});c=c||"Download.bin",window.saveAs?window.saveAs(f,c):navigator.saveBlob(f,c)}:d&&e?a=function(a,g,h){var i,j;if(c){j=new d([a],{type:h||b}),i=e.createObjectURL(j);var k=document.createElement("a");k.setAttribute("href",i),k.setAttribute("download",g||"Download.bin");var l=document.createEvent("MouseEvents");l.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,0,null),k.dispatchEvent(l)}else f[h.split(";")[0]]===!0&&(h=b),j=new d([a],{type:h||b}),i=e.createObjectURL(j),window.open(i,"_blank","");setTimeout(function(){e.revokeObjectURL(i)},250)}:/\bMSIE\b/.test(navigator.userAgent)||(a=function(a,c,d){d||(d=b),f[d.split(";")[0]]===!0&&(d=b),window.open("data:"+d+","+encodeURIComponent(a),"_blank","")}),a}),angular.module("wcagReporter").directive("criterionBody",["directivePlugin","evalSampleModel","selectedCasesOnlyFilter",function(a,b,c){function d(a){var d=b.getFilledPages(),e=a.criterion.getSinglePageAsserts();return a.opt.editable?c(e).sort(function(a,b){return d.indexOf(a.subject[0])-d.indexOf(b.subject[0])}):e.filter(function(a){return a.isDefined()}).sort(function(a,b){return d.indexOf(a.subject[0])-d.indexOf(b.subject[0])})}return a({restrict:"E",replace:!0,transclude:!0,scope:{criterion:"=assert",opt:"=options"},controller:["$scope",function(a){a.opt.editable&&a.criterion.setCaseForEachPage(),a.$on("audit:sample-change",function(){a.multiPageAsserts=a.criterion.getMultiPageAsserts(),a.singlePageAsserts=d(a)})}],link:function(a){a.showBody=function(){return a.multiPageAsserts.length>0||a.singlePageAsserts.length>0||a.opt.editable},a.multiPageAsserts=a.criterion.getMultiPageAsserts(),a.singlePageAsserts=d(a),a.hasMultipage=!1,a.addMultiPage=function(){a.criterion.addTestCaseAssertion({multiPage:!0,subject:b.getSelectedPages()}),a.multiPageAsserts=a.criterion.getMultiPageAsserts()}},templateUrl:"views/directives/criterion/criterionBody.html"})}]),angular.module("wcagReporter").directive("earlAssert",["$filter","directivePlugin","CriterionAssert","$rootScope",function(a,b,c,d){function e(){return["earl:untested","earl:passed","earl:failed","earl:inapplicable","earl:cantTell"].map(function(b){return{id:b,name:a("rdfToLabel")(b)}})}return b({restrict:"E",replace:!0,transclude:!0,scope:{opt:"=options",assert:"="},link:function(b){b.result=b.assert.result,b.outcomes=e(),b.updateMetadata=function(){c.updateMetadata(b.assert)},b.getStaticHtmlResult=function(b){return b=(""+b).trim()||"–","<p><strong>"+a("translate")("HTML_REPORT.LABEL_DESCR")+":</strong> "+a("txtToHtml")(b).substr(3)},b.htmlResult=b.getStaticHtmlResult(b.result.description)},templateUrl:"views/directives/criterion/earlAssert.html"})}]),angular.module("wcagReporter").directive("macroResults",["directivePlugin",function(a){return a({restrict:"E",replace:!0,scope:{criterion:"=value",asserts:"=",opt:"=options"},link:function(a){a.removeAssert=function(b){var c=a.criterion.hasPart.indexOf(b);c>=0&&a.criterion.hasPart.splice(c,1),c=a.asserts.indexOf(b),c>=0&&a.asserts.splice(c,1)},a.transferMacroData=function(b){a.criterion.transferMacroData(b),a.removeAssert(b)},a.getAllTitles=function(a){return a.subject.map(function(a){return a.displayTitle()}).join(", ")}},templateUrl:"views/directives/criterion/macroResults.html"})}]),angular.module("wcagReporter").directive("pageResults",["directivePlugin",function(a){return a({restrict:"E",replace:!0,scope:{criterion:"=value",asserts:"=",opt:"=options"},link:function(a){a.createMacro=function(b){a.criterion.addTestCaseAssertion({result:{description:b.result.description,outcome:b.result.outcome},multiPage:!0})}},templateUrl:"views/directives/criterion/pageResults.html"})}]),angular.module("wcagReporter").directive("pageSelect",["directivePlugin","evalSampleModel",function(a,b){var c;return a({restrict:"E",replace:!0,scope:{pages:"="},controller:["$scope",function(a){a.updateSampleList=function(){a.unselectedPages=c.filter(function(b){return-1===a.pages.indexOf(b)})},a.removePage=function(b){var c=a.pages.indexOf(b);c>=0&&(a.pages.splice(c,1),a.updateSampleList())},a.addPageToAssert=function(){var c=b.getPageByTitle(a.newPage);c&&-1===a.pages.indexOf(c)&&(a.unselectedPages.splice(a.unselectedPages.indexOf(c),1),a.pages.push(c),a.newPage="")},c=b.getPages(),a.updateSampleList()}],templateUrl:"views/directives/criterion/pageSelect.html"})}]),angular.module("wcagReporter").directive("resultDescription",["directivePlugin",function(a){return a({restrict:"E",replace:!0,scope:{value:"=",updateMetadata:"="},templateUrl:"views/directives/criterion/resultDescription.html"})}]),angular.module("wcagReporter").directive("infoButton",["directivePlugin",function(a){return a({restrict:"E",scope:{label:"@",target:"@"},link:function(a,b){var c;b.on("click",function(){c||(c="undefined"==typeof a.target?b.next():angular.element("#"+a.target),c.find(".close").on("click",b.attr.bind(b,"aria-expanded",!1))),c.toggle(200,function(){c.focus(),b.attr("aria-expanded",c.is(":visible"))})})},replace:!0,templateUrl:"views/directives/evaluate/infoButton.html"})}]),angular.module("wcagReporter").directive("infoField",["directivePlugin","$document",function(a,b){function c(a){var c=":input:visible, a[href]:visible",d=b.find(c);return a=angular.element(a).closest(".alert-info").find(c).last(),d[d.index(a)+1]}return a({restrict:"E",scope:{ref:"@",button:"@",exitto:"@"},link:function(a,b){b.hide(0),a.close=function(d){var e;("keyup"!==d.type||13===d.keyCode||27===d.keyCode)&&(a.exitto&&(e=angular.element("#"+a.exitto)),e&&0!==e.length||(e=c(d.target)),e.focus(),b.hide(200))}},replace:!0,transclude:!0,templateUrl:"views/directives/evaluate/infoField.html"})}]),angular.module("wcagReporter").directive("inputPages",["directivePlugin","$timeout","Page",function(a,b,c){return a({restrict:"E",replace:!0,scope:{pages:"=",addPage:"&",removePage:"&"},link:function(a){var d=a.addPage(),e=a.removePage();a.addPage=function(a){var c=angular.element(a.delegateTarget);d(),b(function(){var a=c.prev().find("input");a[a.length-2].select()},100)},a.processPage=function(a){c.prependProtocol(a),c.updateSource(a)},a.removePage=function(a,c){e(a),b(function(){angular.element(c.delegateTarget).closest("fieldset").parent().children().last().focus()})}},templateUrl:"views/directives/evaluate/inputPages.html"})}]),angular.module("wcagReporter").directive("techSelect",function(){function a(a,c,d){b.forEach(function(b){a[c]===b[c]&&(a[d]=b[d])})}var b=[{title:"HTML5",specs:"http://www.w3.org/TR/html5/"},{title:"CSS",specs:"http://www.w3.org/Style/CSS/specs/"},{title:"HTML 4.01",specs:"http://www.w3.org/TR/html401/"}];return{restrict:"E",replace:!0,scope:{selected:"="},link:function(c){c.technolgies=b,c.updateTitle=function(b){a(b,"specs","title")},c.updateSpec=function(b){a(b,"title","specs")}},templateUrl:"views/directives/evaluate/techSelect.html"}}),angular.module("wcagReporter").directive("iconButton",["directivePlugin",function(a){return a({restrict:"E",replace:!0,scope:{label:"=",icon:"=",click:"&"},templateUrl:"views/directives/evaluate/iconButton.html"})}]),angular.module("wcagReporter").directive("buttonCollapse",["directivePlugin",function(a){return a({restrict:"E",replace:!0,transclude:!0,scope:{obj:"=target",prop:"@property"},link:function(a,b,c){void 0!==c.collapsed&&void 0===a.obj[a.prop]&&(a.obj[a.prop]=!0)},templateUrl:"views/directives/buttonCollapse.html"})}]),angular.module("wcagReporter").directive("fullReport",["directivePlugin","$interval",function(a,b){function c(a){return function(b){return 0===a.find(b).length}}return a({restrict:"E",replace:!0,link:function(a,d){var e=[".panel-heading",".sample_narrow",".score-total"],f=b(function(){e=e.filter(c(d)),0===e.length&&(a.$emit("reportReady",d),b.cancel(f))},200)},templateUrl:"views/directives/fullReport.html"})}]),angular.module("wcagReporter").directive("successCriterion",["directivePlugin","$rootScope","toggleCriterionText",function(a,b,c){var d={"earl:untested":"untested","earl:passed":"passed","earl:failed":"failed","earl:inapplicable":"inapplicable","earl:cantTell":"canttell"};return a({restrict:"E",replace:!0,scope:{assert:"=assertion",spec:"=requirement",opt:"=options"},link:function(a){window.toggleCriterionText=c,a.rootHide=b.rootHide,a.critHide=a.spec.id+"-cb",a.getClassName=function(a){return d[a]}},toggleCriterionText:c,templateUrl:"views/directives/successCriterion.html"})}]),angular.module("wcagReporter").directive("autoResize",["directivePlugin",function(a){return a({restrict:"A",link:function(a,b){a.$evalAsync(function(){angular.element(b).textareaAutoSize()})}})}]),angular.module("wcagReporter").directive("shyPlaceholder",["directivePlugin",function(a){var b="placeholder";return a({restrict:"A",scope:{shyPlaceholder:"="},compile:function(a,c){return function(a,d){var e=a.$eval(c.shyPlaceholder);d.attr(b,e).bind({focus:d.attr.bind(d,b,""),blur:d.attr.bind(d,b,e)})}}})}]),angular.module("wcagReporter").directive("collapse",["$animate",function(a){return{link:function(b,c,d){function e(b){function d(){j===f&&(j=void 0)}var e={};Object.keys(b).forEach(function(a){e[a]=c.css(a)});var f=a.animate(c,e,b);return j&&a.cancel(j),j=f,f.then(d,d),f}function f(){k?(k=!1,g()):(c.removeClass("collapse").addClass("collapsing"),e({height:c[0].scrollHeight+"px"}).then(g))}function g(){c.removeClass("collapsing"),c.addClass("collapse in"),c.css({height:"auto"})}function h(){if(k)k=!1,i(),c.css({height:0});else{c.css({height:c[0].scrollHeight+"px"});c[0].offsetWidth;c.removeClass("collapse in").addClass("collapsing"),e({height:0}).then(i)}}function i(){c.removeClass("collapsing"),c.addClass("collapse")}var j,k=!0;b.$watch(d.collapse,function(a){a?h():f()})}}}]),angular.module("wcagReporter").constant("dropdownConfig",{openClass:"open"}).service("dropdownService",["$document",function(a){var b=null;this.open=function(e){b||(a.bind("click",c),a.bind("keydown",d)),b&&b!==e&&(b.isOpen=!1),b=e},this.close=function(e){b===e&&(b=null,a.unbind("click",c),a.unbind("keydown",d))};var c=function(a){if(b){var c=b.getToggleElement();a&&c&&c[0].contains(a.target)||b.$apply(function(){b.isOpen=!1})}},d=function(a){27===a.which&&(b.focusToggleElement(),c())}}]).controller("DropdownController",["$scope","$attrs","$parse","dropdownConfig","dropdownService","$animate",function(a,b,c,d,e,f){var g,h=this,i=a.$new(),j=d.openClass,k=angular.noop,l=b.onToggle?c(b.onToggle):angular.noop;this.init=function(d){h.$element=d,b.isOpen&&(g=c(b.isOpen),k=g.assign,a.$watch(g,function(a){i.isOpen=!!a}))},this.toggle=function(a){return i.isOpen=arguments.length?!!a:!i.isOpen},this.isOpen=function(){return i.isOpen},i.getToggleElement=function(){return h.toggleElement},i.focusToggleElement=function(){h.toggleElement&&h.toggleElement[0].focus()},i.$watch("isOpen",function(b,c){f[b?"addClass":"removeClass"](h.$element,j),b?(i.focusToggleElement(),e.open(i)):e.close(i),k(a,b),angular.isDefined(b)&&b!==c&&l(a,{open:!!b})}),a.$on("$locationChangeSuccess",function(){i.isOpen=!1}),a.$on("$destroy",function(){i.$destroy()})}]).directive("dropdown",function(){return{controller:"DropdownController",link:function(a,b,c,d){d.init(b)}}}).directive("dropdownToggle",function(){return{require:"?^dropdown",link:function(a,b,c,d){if(d){d.toggleElement=b;var e=function(e){e.preventDefault(),b.hasClass("disabled")||c.disabled||a.$apply(function(){d.toggle()})};b.bind("click",e),b.attr({"aria-haspopup":!0,"aria-expanded":!1}),a.$watch(d.isOpen,function(a){b.attr("aria-expanded",!!a)}),a.$on("$destroy",function(){b.unbind("click",e)})}}}}),angular.module("wcagReporter").filter("getUrl",function(){var a=/((https?):\/\/)([\da-z\.-]+)\.([a-z\.]{2,6})([\-\w\d@:%_\+.~#?,&\/\/=]+)/g;return function(b){var c;return"string"==typeof b&&(c=b.match(a)),c?c[0]:!1}}),angular.module("wcagReporter").filter("selectedCasesOnly",function(){function a(a){for(var b=0;b<a.subject.length;b++){var c=a.subject[b];if(c.selected&&(c.title||c.description))return!0}return!1}return function(b){return b?b.filter(a):void 0}}),angular.module("wcagReporter").filter("rdfToLabel",["$filter",function(a){var b,c={"earl:passed":"PASSED","earl:failed":"FAILED","earl:cantTell":"CANT_TELL","earl:inapplicable":"NOT_PRESENT","earl:untested":"NOT_CHECKED",A:"LEVEL_A",AA:"LEVEL_AA",AAA:"LEVEL_AAA","wai:WCAG2A-Conformance":"LEVEL_A","wai:WCAG2AA-Conformance":"LEVEL_AA","wai:WCAG2AAA-Conformance":"LEVEL_AAA"};return b=function(b){return a("translate")("EARL."+c[b])},b.keymap=c,b.$stateful=!0,b}]),angular.module("wcagReporter").filter("txtToHtml",["$filter",function(a){return function(b){return"string"!=typeof b?"":b.split("\n").reduce(function(b,c){return""===c.trim()?b+"</p><p>":(c=a("linky")(c,"_blank"),b+("<p>"===b.substr(-3)?"":"<br />")+c)},"<p>")+"</p>"}}]),angular.module("wcagReporter").service("appState",["$rootScope","$document","translateFilter",function(a,b,c){function d(){return f}var e,f=c("COMMON.WARNING_BEFORE_UNLOAD"),g=window.jQuery(window);return e={pristine:!0,empty:!0,currentStateIndex:0,maxStateIndex:0,stateList:[{name:"start",route:"/",copmlete:!1},{name:"scope",route:"/evaluation/scope",copmlete:!1},{name:"explore",route:"/evaluation/explore",copmlete:!1},{name:"sample",route:"/evaluation/sample",copmlete:!1},{name:"audit",route:"/evaluation/audit",copmlete:!1},{name:"report",route:"/evaluation/report",copmlete:!1},{name:"viewReport",route:"/view_report",copmlete:!1}]},e.moveToState=function(a){var b,c;for(b=0;b<this.stateList.length;b+=1)if(e.stateList[b].name===a){c=b;break}return e.currentStateIndex=c,e.maxStateIndex<c&&(e.maxStateIndex=c),e},e.getPreviousState=function(){return e.stateList[e.currentStateIndex-1]},e.getNextState=function(){return e.stateList[e.currentStateIndex+1]},e.setPrestineState=function(){e.pristine=!0,g.off("beforeunload",d),b.one("change","input[type=text], textarea, select",e.setDirtyState),a.$emit("appstate:prestine")},e.setDirtyState=function(){e.pristine&&(a.$emit("appstate:dirty"),g.on("beforeunload",d)),e.pristine=!1,e.empty=!1},e.init=function(){b.one("change","input[type=text], textarea, select",e.setDirtyState)},e.hasBrowserSupport=function(){var a=!0;return window.Blob||(console.error("Blob not supported in this browser."),a=!1),window.FileReader||(console.error("FileReader not supported in this browser."),a=!1),window.navigator.msSaveOrOpenBlob||(window.URL||window.webkitURL)&&(window.URL||window.webkitURL).createObjectURL||(console.error("msSaveOrOpenBlob or createObjectURL not supported in this browser."),a=!1),a},e}]),angular.module("wcagReporter").provider("wcag2spec",function(){function a(a){return function(b,c){return angular.isArray(b)||(b=b[a]),b.concat(c[a])}}var b,c,d,e,f=angular.noop,g={},h={},i={addSpec:function(a,b){a=a.toLowerCase(),h[a]=b,e||i.useLanguage(a)},loadLanguage:function(a){if(a=a.toLowerCase(),"string"!=typeof b)throw new Error("specPath must be defined first");if(h[a])return i.useLanguage(a);var c=b.replace("${lang}",a.toLowerCase());$.getJSON(c).done(function(b){h[a]=b,i.useLanguage(a),f("wcag2spec:load",a)}).fail(console.error.bind(console))},useLanguage:function(b){if(b=b.toLowerCase(),!h[b])throw new Error("Spec for lang "+b+" not defined.");e=h[b],c=e.principles.reduce(a("guidelines"),[]),d=c.reduce(a("successcriteria"),[]),d.forEach(function(a){-1!==["A","AA","AAA"].indexOf(a.level)&&(a.level="wai:WCAG2"+a.level+"-Conformance",g[a.id]=a)}),f("wcag2spec:langChange",b)},getGuidelines:function(){return c},getCriteria:function(){return d},getCriterion:function(a){return g[a]},getPrinciples:function(){return e.principles},isLoaded:function(){return"undefined"!=typeof e},onLangChange:angular.noop};this.setSpecPath=function(a){b=a},this.loadLanguage=i.loadLanguage,this.$get=["$rootScope",function(a){return f=a.$broadcast.bind(a),i.onLangChange=a.$on.bind(a,"wcag2spec:langChange"),angular.extend({},i)}]}),angular.module("wcagReporter").service("CriterionAssert",["evalSampleModel","$filter","TestCaseAssert","wcag2spec","currentUser",function(a,b,c,d,e){function f(a){var b=this;for(var c in f.prototype)this.hasOwnProperty(c)||(this[c]=f.prototype[c]);this.test=a,this.hasPart=[],this.result={outcome:"earl:untested",description:""},this.getSinglePageAsserts=function(){return b.hasPart.filter(function(a){return a.multiPage!==!0})},this.getMultiPageAsserts=function(){return b.hasPart.filter(function(a){return a.multiPage===!0})},this.addPage=function(a){this.addTestCaseAssertion({subject:[a]})},this.removePage=function(a){var b=this.hasPart;b.map(function(a){return a.subject[0].id});b.forEach(function(c,d){var e=c.subject.indexOf(a);-1!==e&&(c.multiPage?b.subject.splice(e,1):b.splice(d,1))})}}return f.prototype={type:"Assertion",test:void 0,assertedBy:void 0,subject:"_:website",result:void 0,mode:void 0,hasPart:void 0,getSinglePageAsserts:void 0,getMultiPageAsserts:void 0,addTestCaseAssertion:function(a){var b,d=new c;if(d.testcase=this.test,this.hasPart.push(d),a)for(b in a)"subject"===b?d.setSubject(a.subject):d[b]=a[b]},transferMacroData:function(a){this.getSinglePageAsserts().filter(function(b){return-1!==a.subject.indexOf(b.subject[0])}).forEach(function(b){"string"!=typeof b.result.description&&(b.result.description=""),""===b.result.description.trim()?b.result.description=a.result.description.trim():b.result.description=(a.result.description+"\n\n"+b.result.description).trim(),b.result.outcome=a.result.outcome})},setCaseForEachPage:function(){var b,c=this;b=this.hasPart.filter(function(a){return angular.isArray(a.subject)&&1===a.subject.length}).map(function(a){return a.subject[0]}),a.getPages().filter(function(a){return-1===b.indexOf(a)}).forEach(function(a){c.addTestCaseAssertion({subject:[a]})})},getSpec:function(){return d.getCriterion(this.test)}},f.isDefined=function(a){var b=a.hasPart.reduce(function(a,b){return a||b.isDefined()?!0:!1},!1);return b||!!a.result.description||"earl:untested"!==a.result.outcome},f.updateMetadata=function(a){a.assertedBy=e.id,a.mode="earl:manual",a.result.date=b("date")(Date.now(),"yyyy-MM-dd HH:mm:ss Z")},f}]),angular.module("wcagReporter").service("TestCaseAssert",["evalSampleModel","currentUser",function(a,b){function c(){for(var a in c.prototype)this.hasOwnProperty(a)||(this[a]=c.prototype[a]);this.subject=[],this.result=Object.create(d)}var d={description:"",outcome:"earl:untested"};return c.isDefined=function(a){var b=!1;return a.subject.forEach(function(a){b=b||a.title||a.description}),(a.result.description||a.result.outcome!==d.outcome)&&b},c.prototype={type:"Assertion",assertedBy:b.id,subject:void 0,testCase:void 0,result:void 0,multiPage:!1,mode:"earl:manual",isDefined:function(){return c.isDefined(this)},addNewPage:function(a){this.subject.push(a)},removePage:function(a){this.subject.splice(a,1)},setSubject:function(b){var c=[];this.subject=c,b&&!angular.isArray(b)&&(b=[b]),b.forEach(function(b){"string"==typeof b&&(b=a.getPageById(b)),"object"==typeof b&&c.push(b)})}},c}]),angular.module("wcagReporter").service("Page",["$filter",function(a){function b(){this.type=["TestSubject","WebPage"]}var c=a("translate");return b.updateSource=function(b){var c=a("getUrl")(b.description);return c?b.source=c:delete b.source,c},b.prependProtocol=function(a){a.description&&a.description.match(/^([\da-z\.-]+)\.([a-z\.]{2,6})/)&&(a.description="http://"+a.description)},b.openInWindow=function(a,b){b=b||"_blank",a.source&&window.open(a.source,b)},b.prototype={type:["TestSubject","WebPage"],id:"",description:void 0,title:"",tested:!1,selected:!1,displayTitle:function(){var a=0;return this.title.trim()?this.title:"_:struct_"===this.id.substr(0,9)?(a=+this.id.substr(9),c("SAMPLE.STRUCTURED_PAGE")+" "+(a+1)):"_:rand_"===this.id.substr(0,7)?(a=+this.id.substr(7),c("SAMPLE.RANDOM_PAGE")+" "+(a+1)):c("SAMPLE.SAMPLE_PAGE")}},b}]),angular.module("wcagReporter").service("evalScopeModel",function(){
var a={type:"EvaluationScope",conformanceTarget:"wai:WCAG2AA-Conformance",additionalEvalRequirement:"",website:{type:["TestSubject","WebSite"],id:"_:website",siteName:"",siteScope:""},accessibilitySupportBaseline:""};return a.exportData=function(){return{type:a.type,conformanceTarget:a.conformanceTarget,additionalEvalRequirement:a.additionalEvalRequirement,website:{type:a.website.type,id:a.website.id,siteName:a.website.siteName,siteScope:a.website.siteScope},accessibilitySupportBaseline:a.accessibilitySupportBaseline}},a.conformanceOptions=["wai:WCAG2A-Conformance","wai:WCAG2AA-Conformance","wai:WCAG2AAA-Conformance"],a.validate=function(){return[]},a.matchConformTarget=function(b){return a.conformanceTarget.length>=b.length},Object.preventExtensions(a.website),Object.preventExtensions(a),a}),angular.module("wcagReporter").service("currentUser",function(){return{"@context":{"@vocab":"http://xmlns.com/foaf/0.1/",id:"@id",type:"@type"},id:"_:evaluator",type:"Person",name:""}}),angular.module("wcagReporter").service("evalExploreModel",["knownTech","evalSampleModel",function(a,b){var c={commonPages:[],otherRelevantPages:[],knownTech:a},d=["reliedUponTechnology","essentialFunctionality","pageTypeVariety"];return d.forEach(function(a){c[a]=void 0}),c.reliedUponTechnology=[],c.importData=function(a){angular.isArray(a.reliedUponTechnology)||(a.reliedUponTechnology=[a.reliedUponTechnology]),d.forEach(function(b){a[b]&&(c[b]=a[b])})},c.exportData=function(){var a={};return d.forEach(function(b){a[b]=c[b]}),a},c.validate=function(){return[]},Object.preventExtensions(c),c}]),angular.module("wcagReporter").service("evalSampleModel",["Page",function(a){function b(a){var b,e;return c.isArray(a.webpage)&&0!==a.webpage.length?(b=a===d.randomSample?"_:rand_":"_:struct_",e=a.webpage.map(function(a){return+a.id.substr(b.length)}).sort(function(a,b){return a-b}).pop(),e+1):0}var c=angular,d={},e=[],f=[];return d.structuredSample={webpage:e},d.randomSample={webpage:f},d.removePage=function(a,b){var d;return c.isNumber(b)||(b=a.webpage.indexOf(b)),c.isNumber(b)&&b>=0&&(d=a.webpage.splice(b,1)[0]),d},d.addNewStructuredPage=function(){var c=d.structuredSample,e=new a,f=b(c);return c.webpage.push(e),e.id="_:struct_"+f,e.title="",e},d.addNewRandomPage=function(){var c=new a,e=b(d.randomSample);return d.randomSample.webpage.push(c),c.id="_:rand_"+e,c.title="",c},d.addNewPage=function(a){return a===d.randomSample?d.addNewRandomPage():d.addNewStructuredPage()},d.getPageByTitle=function(a){var b;return d.getPages().forEach(function(c){c.title===a&&(b=c)}),b},d.getPages=function(){return d.structuredSample.webpage.concat(d.randomSample.webpage)},d.getFilledPages=function(){return d.getPages().filter(function(a){return a.description||a.title})},d.getSelectedPages=function(){return d.getPages().reduce(function(a,b){return b.selected&&a.push(b),a},[])},d.validate=function(){return[]},d.exportData=function(){var a,b=["type","id","description","source","title","tested"];return a=[d.structuredSample.webpage,d.randomSample.webpage].map(function(a){return a.map(function(a){var c={};return b.forEach(function(b){c[b]=a[b]}),c})}),{structuredSample:{webpage:a[0]},randomSample:{webpage:a[1]}}},d.importData=function(b){["structuredSample","randomSample"].forEach(function(e){d[e]=b[e],"object"!=typeof b[e]&&(d[e]={}),"undefined"==typeof d[e].webpage?d[e].webpage=[]:c.isArray(d[e].webpage)||(d[e].webpage=[d[e].webpage]),d[e].webpage.forEach(function(b){b.displayTitle=a.prototype.displayTitle})})},d.getPageById=function(a){for(var b=d.getPages(),c=0;c<b.length;c++)if(b[c].id===a)return b[c]},Object.preventExtensions(d),d}]),angular.module("wcagReporter").service("evalAuditModel",["TestCaseAssert","evalScopeModel","wcag2spec","CriterionAssert",function(a,b,c,d){var e,f={};return c.onLangChange(function(){c.getCriteria().forEach(function(a){"undefined"==typeof f[a.id]&&e.addCritAssert({test:a.id})})}),e={criteria:f,exportData:function(){var b=angular.copy(e.getCriteriaSorted());return b.reduce(function(b,c){return c.hasPart=c.hasPart.filter(function(b){return a.isDefined(b)}),Object.keys(c).forEach(function(a){"function"==typeof c[a]&&delete c[a]}),b.push.apply(b,c.hasPart),b},[]).forEach(function(a){a.subject=a.subject.map(function(a){return a.id})}),b},importData:function(a){a.auditResult&&(angular.isArray(a.auditResult)||(a.auditResult=[a.auditResult]),f={},e.criteria=f,a.auditResult.forEach(e.addCritAssert))},getCritAssert:function(a){if("object"!=typeof f[a])throw new Error("Unknown criterion of id "+a);return f[a]},getCriteriaSorted:function(){if(!c.isLoaded())return[];var a=c.getCriteria();return a.map(function(a){return f[a.id]}).filter(angular.isDefined)},addCritAssert:function(a){var b,c=Object.create(d.prototype);d.apply(c);for(b in a)"hasPart"===b?(angular.isArray(a.hasPart)||(a.hasPart=[a.hasPart]),a.hasPart.forEach(c.addTestCaseAssertion,c)):c[b]=a[b];f[c.test]=c},addPageForAsserts:function(a){Object.keys(f).forEach(function(b){f[b].addPage(a)})},removePageFromAsserts:function(a){Object.keys(f).forEach(function(b){f[b].removePage(a)})}}}]),angular.module("wcagReporter").service("evalReportModel",["$filter","currentUser",function(a,b){var c={creator:b,title:"",summary:"",specifics:"",commissioner:""},d=Object.create(c);return c.date=a("date")(new Date,"longDate"),d.exportData=function(){var a=angular.copy(d);return a.creator=a.creator.id,a},d.importData=function(a){Object.keys(c).forEach(function(b){angular.isDefined(a[b])&&(d[b]=a[b])})},d.setDefaultTitle=function(a){d.title||(d.title=a)},d}]),angular.module("wcagReporter").factory("evalModel",["evalScopeModel","evalExploreModel","evalSampleModel","evalAuditModel","evalReportModel","evalContextV2","currentUser",function(a,b,c,d,e,f,g){var h={id:void 0,type:"Evaluation",context:f,scopeModel:a,exploreModel:b,sampleModel:c,auditModel:d,reportModel:e,otherData:[g]};return h}]),angular.module("wcagReporter").factory("wcagReporterImport",["$rootScope","evalModel","currentUser","reportStorage","importV1","changeLanguage",function(a,b,c,d,e,f){function g(a,b){Object.keys(a).forEach(function(c){"function"!=typeof a[c]&&"undefined"!=typeof b[c]&&(a[c]=b[c])})}function h(a){var d,e=[],f=0,g=b.context["@vocab"]+b.type,h=c["@context"]["@vocab"]+c.type;return d=function(b,c){e.push(c),e.length===f&&a(e)},function(a){f+=1,a["@type"]&&-1!==a["@type"].indexOf(g)?j.compact(a,b.context,d):a["@type"]&&-1!==a["@type"].indexOf(h)?j.compact(a,c["@context"],d):e.push(a)}}function i(a){a.evaluationScope&&g(b.scopeModel,a.evaluationScope),b.id=a.id,b.type=a.type,b.sampleModel.importData(a),b.reportModel.importData(a),b.auditModel.importData(a),b.exploreModel.importData(a),b.otherData=a.otherData}var j=window.jsonld,k={storage:d,fromJson:function(a){k.fromObject(angular.fromJson(a))},getFromUrl:function(){return d.get().then(function(a){return k.fromJson(a),a})},fromObject:function(a){angular.isArray(a["@graph"])&&"object"==typeof a["@graph"][0]&&"evaluation"===a["@graph"][0].type.toLowerCase()&&(a["@graph"]=e(a["@graph"])),j.expand(a,function(a,b){a&&console.error(a),k.fromExpanded(b)})},fromExpanded:function(b){b.forEach(h(function(b){var d=b.reduce(function(a,b){if("Evaluation"===b.type){if("undefined"!=typeof a)throw new Error("Only one evaluation object allowed in JSON data");return b}return a},void 0);if(!d)throw new Error("No evaluation found in data");"string"==typeof d.creator&&0===d.creator.indexOf("_:")&&(c.id=d.creator),d.creator=c;var e=!1;b.forEach(function(a){e||"Person"!==a.type||a.id!==c.id||(angular.extend(c,a),e=!0)}),d.otherData=b.reduce(function(a,b){return b!==d&&b.id!==c.id&&a.push(b),a},[c]),d.lang&&(angular.isArray(d.lang)&&(d.lang=d.lang.join("")),f(d.lang)),a.$apply(function(){i(d)})}))}};return k}]),angular.module("wcagReporter").factory("importV1",["evalContextV1","evalContextV2","$filter",function(a,b,c){function d(a){return a.map(function(a){return e(a)?a=g(a):"object"==typeof a&&"object"==typeof a["@context"]&&"http://xmlns.com/foaf/spec/#"===a["@context"]["@vocab"]&&(a["@context"]["@vocab"]="http://xmlns.com/foaf/0.1/"),a})}function e(b){if("object"!=typeof b)throw new TypeError("Expected object for "+b);var c=b["@context"],d=Object.keys(a);return"object"!=typeof c?!1:d.sort().join(",")!==Object.keys(c).sort().join(",")?!1:d.reduce(function(b,d){return b?"undefined"==typeof c[d]?!1:"string"==typeof c[d]&&c[d]!==a[d]?!1:"object"==typeof c[d]?Object.keys(a[d]).reduce(function(b,e){return b?"undefined"==typeof c[d][e]?!1:"string"==typeof c[d][e]&&c[d][e]!==a[d][e]?!1:!0:b},!0):!0:b},!0)}function f(a){"webpage"===a.type&&(a.type=["TestSubject","WebPage"]),a.title=a.handle,delete a.handle;var b=h(a.description);b&&(a.source=b)}function g(a){a["@context"]=b,a.type=a.type.replace("evaluation","Evaluation");var c=a.evaluationScope;c.type=c.type||"EvaluationScope",c.website.type=c.website.type||["TestSubject","WebSite"],a.reliedUponTechnology.forEach(function(a){a.type=a.type||"Technology"});var c=a.evaluationScope;return"wcag20:level_"===c.conformanceTarget.substr(0,13)&&(c.conformanceTarget="wai:WCAG2"+c.conformanceTarget.replace("wcag20:level_","").toUpperCase()+"-Conformance"),c.website.title&&(c.website.siteName=c.website.title,delete c.website.title),angular.isArray(a.structuredSample.webpage)||(a.structuredSample.webpage=[a.structuredSample.webpage]),a.structuredSample.type=a.structuredSample.type||"Sample",a.structuredSample.webpage.forEach(f),angular.isArray(a.randomSample.webpage)||(a.randomSample.webpage=[a.randomSample.webpage]),a.randomSample.type=a.randomSample.type||"Sample",a.randomSample.webpage.forEach(f),a.auditResult.forEach(function d(a){a.type=a.type.replace("earl:assertion","Assertion"),a.testRequirement?(a.test=a.testRequirement.replace("wcag20:","WCAG2:"),delete a.testRequirement):(a.test=a.testcase.replace("wcag20:","WCAG2:"),delete a.testcase),a.result.type=a.result.type||"TestResult","manual"===a.mode&&(a.mode="earl:manual"),a.hasPart&&a.hasPart.forEach(d)}),a}var h=c("getUrl");return d.isV1Evaluation=e,d.upgradeToV2=g,d}]),angular.module("wcagReporter").factory("wcagReporterExport",["evalModel","reportStorage","pkgData","$rootScope",function(a,b,c,d){function e(){var b={"@context":a.context,type:a.type,id:a.id,publisher:"reporter:releases/tag/"+c.version,lang:d.lang};return b.evaluationScope=a.scopeModel.exportData(),b.auditResult=a.auditModel.exportData(),angular.extend(b,a.reportModel.exportData(),a.sampleModel.exportData(),a.exploreModel.exportData()),b}var f={storage:b,saveToUrl:function(){return b.post(f.getJson())},getJson:function(){return{"@graph":[e()].concat(a.otherData)}},getString:function(){return angular.toJson(f.getJson(),!0)},getBlobUrl:function(a){try{return a=a||f.getBlob(),(window.URL||window.webkitURL).createObjectURL(a)}catch(b){console.error(b)}},saveBlobIE:function(a,b){a=a||f.getBlob(),b=b||f.getFileName(),window.navigator.msSaveOrOpenBlob&&window.navigator.msSaveBlob(a,b)},getBlob:function(a,b){return a=a||f.getString(),b=b||"application/json;charset=utf-8",new Blob([a],{type:b})},getFileName:function(b){var c=a.scopeModel.website.siteName+" evaluation report";return b=b||"json",c=c.trim(),c.replace(/(^\-+|[^a-zA-Z0-9\/_| -]+|\-+$)/g,"").toLowerCase().replace(/[\/_| -]+/g,"-")+"."+b}};return b.exportModel=f,f}]),angular.module("wcagReporter").controller("NavigationCtrl",["$scope","$rootScope","supportedLanguages","changeLanguage",function(a,b,c,d){a.languages=c,a.currentLang=b.lang,b.$on("$translateChangeSuccess",function(b,c){a.currentLang=c.language.toLowerCase()}),a.changeLanguage=d}]),angular.module("wcagReporter").controller("StartCtrl",["$scope","$location","appState","$timeout","$rootScope",function(a,b,c,d,e){a.state=c.moveToState("start"),"undefined"==typeof e.rootHide.start1&&(a.initial="hidden",d(function(){a.initial=""},500),d(function(){e.rootHide.start1=!1},700)),a.nextStep=function(){b.path("/evaluation/scope")},a.nextStepName="STEP_SCOPE"}]),angular.module("wcagReporter").controller("StepButtonsCtrl",["$scope","$location","appState",function(a,b,c){var d=c.getPreviousState(),e=c.getNextState();e&&(a.nextStep=function(){b.path(e.route)},a.nextStepName="STEP_"+e.name.toUpperCase()),d&&(a.previousStep=function(){b.path(d.route)},a.previousStepName="STEP_"+d.name.toUpperCase())}]),angular.module("wcagReporter").controller("EvalScopeCtrl",["$scope","appState","evalScopeModel","evalReportModel","$filter",function(a,b,c,d,e){a.state=b.moveToState("scope"),a.scopeModel=c,a.conformanceOptions=c.conformanceOptions.reduce(function(a,b){return a[b]=e("rdfToLabel")(b),a},{}),a.$on("$routeChangeStart",function(){if(c.website.siteName){var a=e("translate"),b=a("REPORT.TITLE_PREFIX")+" "+c.website.siteName;d.setDefaultTitle(b)}})}]),angular.module("wcagReporter").controller("EvalExploreCtrl",["$scope","appState","$timeout","evalExploreModel",function(a,b,c,d){a.state=b.moveToState("explore"),a.exploreModel=d,a.updateSpec=function(a){e[a.title]&&(a.id=e[a.title])},a.knownTech=angular.copy(d.knownTech),a.otherTech=[],d.reliedUponTechnology.forEach(function(b){var c=a.knownTech.reduce(function(a,c,d){return c.id===b.id&&c.title===b.title?d:a},-1);-1!==c?a.knownTech[c].checked=!0:a.otherTech.push(b)}),0===a.otherTech.length?a.otherTech.push({type:"Technology"}):a.rootHide.OtherTech=a.rootHide.OtherTech||!0,a.changeTech=function(a){if(a.checked){var b=angular.extend({},a);delete b.checked,d.reliedUponTechnology.push(b)}else d.reliedUponTechnology=d.reliedUponTechnology.filter(function(b){return b.title!==a.title&&b.id!==a.id})},a.updateOtherTech=function(a){var b=d.reliedUponTechnology.indexOf(a),c=!a.title&&!a.id;-1!==b||c?-1!==b&&c&&d.reliedUponTechnology.splice(b,1):d.reliedUponTechnology.push(a)},a.addTechnology=function(b){if(a.otherTech.push({type:"Technology"}),b){var d=angular.element(b.delegateTarget);c(function(){var a=d.prev().find("input");a[a.length-2].select()},100)}},a.removeTechnology=function(b,e){var f=a.otherTech[b],g=d.reliedUponTechnology.indexOf(f);d.reliedUponTechnology.splice(g,1),a.otherTech.splice(b,1),e&&c(function(){angular.element(e.delegateTarget).closest("fieldset").parent().children().last().focus()})};var e={};a.knownTech.forEach(function(a){e[a.title]=a.id})}]),angular.module("wcagReporter").controller("EvalSampleCtrl",["$scope","appState","evalExploreModel","evalSampleModel","evalAuditModel",function(a,b,c,d,e){if(a.state=b.moveToState("sample"),a.structuredSample=d.structuredSample,a.randomSample=d.randomSample,a.exploreModel=c,a.structuredSample&&0===a.structuredSample.webpage.length){var f=d.addNewStructuredPage();if(e.addPageForAsserts(f),a.randomSample&&0===a.randomSample.webpage.length){var g=d.addNewRandomPage();e.addPageForAsserts(g)}}a.getPageAdder=function(b){return function(){var c=d.addNewPage(b);e.addPageForAsserts(c);var f=a.structuredSample.webpage.length,g=Math.ceil(f/10);if(a.randomSample.webpage.length+1===g&&f%10===1){var h=d.addNewPage(a.randomSample);e.addPageForAsserts(h)}return c}},a.getPageRemover=function(a){return function(b){var c=d.removePage(a,b);e.removePageFromAsserts(c)}},a.randPageCount=function(){return Math.ceil(a.structuredSample.webpage.length/10)}}]),angular.module("wcagReporter").controller("EvalAuditCtrl",["$scope","appState",function(a,b){a.state=b.moveToState("audit")}]),angular.module("wcagReporter").controller("AuditCriteriaCtrl",["$scope","evalAuditModel","evalScopeModel","wcag2spec","$rootElement","$anchorScroll","$filter","$rootScope","$timeout",function(a,b,c,d,e,f,g,h,i){function j(a,b){var c=b[a.length];a.push(c),a.length!==b.length&&i(function(){j(a,b)},50)}var k=[];a.criteria=b.getCriteriaSorted(),a.getCritAssert=b.getCritAssert,a.principles=[],d.isLoaded()&&(k=d.getPrinciples(),j(a.principles,k)),a.$on("wcag2spec:langChange",function(){k=d.getPrinciples(),a.principles=[],j(a.principles,k)}),h.rootHide.criteria?a.critFilter=h.rootHide.criteria:(a.critFilter={"wai:WCAG2A-Conformance":c.matchConformTarget("wai:WCAG2A-Conformance"),"wai:WCAG2AA-Conformance":c.matchConformTarget("wai:WCAG2AA-Conformance"),"wai:WCAG2AAA-Conformance":c.matchConformTarget("wai:WCAG2AAA-Conformance")},h.rootHide.criteria=a.critFilter),a.isCriterionVisible=function(c){if(a.critFilter[c.level]!==!0)return!1;var d=b.getCritAssert(c.id);return"object"!=typeof d||"object"!=typeof d.result?!1:!0},a.isGuidelineVisible=function(b){var c=!1;return b.successcriteria.forEach(function(b){(c||a.isCriterionVisible(b))&&(c=!0)}),c},a.isPrincipleVisible=function(b){var c=!1;return b.guidelines.forEach(function(b){(c||a.isGuidelineVisible(b))&&(c=!0)}),c};var l=["earl:untested","earl:cantTell"];a.criteriaUntested=function(a){var c=0;return a.successcriteria.forEach(function(a){var d=b.getCritAssert(a.id);-1!==l.indexOf(d.result.outcome)&&(c+=1)}),c},a.toTop=function(){$("html, body").animate({scrollTop:e.offset().top},200,e.focusH1)}}]),angular.module("wcagReporter").controller("AuditSamplePagesCtrl",["$scope","evalSampleModel","Page","$rootScope",function(a,b,c,d){var e=b.getSelectedPages,f=b.getPages;a.structuredSample=b.structuredSample,a.randomSample=b.randomSample,a.filledPages=function(){return b.getFilledPages()},a.auditSize=e.length,a.anySelect=0!==a.auditSize,a.openSelected=function(){e().forEach(function(a){c.openInWindow(a)})},a.openPage=c.openInWindow,a.changeAll=function(){var b=f();b.forEach(function(b){b.selected=a.anySelect}),a.sampleChange()};var g;a.multiSelect=function(c,d){if("input"===d.toElement.nodeName.toLowerCase()){if("undefined"!=typeof g&&d.shiftKey){for(var e=b.getFilledPages(),f=Math.min(g,c),h=Math.max(g,c),i=e[c].selected,j=f;h>=j;j++)e[j].selected=i;a.sampleChange()}g=c}},a.sampleChange=function(){var b=e().length;a.auditSize=b,a.anySelect=b>0,d.$broadcast("audit:sample-change")},a.completePages=function(){e().forEach(function(a){a.tested=!0})},a.uncompletePages=function(){e().forEach(function(a){a.tested=!1})}}]),angular.module("wcagReporter").controller("EvalReportCtrl",["$scope","appState","evalReportModel",function(a,b,c){a.state=b.moveToState("report"),a.reportModel=c}]),angular.module("wcagReporter").controller("ViewReportCtrl",["$scope","$document","wcag2spec","evalModel","appState","wcagReporterExport","toggleCriterionText",function(a,b,c,d,e,f,g){var h;a.state=e.moveToState("viewReport"),a.scope=d.scopeModel,a.explore=d.exploreModel,a.filledPages=function(){return d.sampleModel.getFilledPages()},a.wcag2specReady=c.isLoaded(),a.$on("wcag2spec:langChange",function(){a.wcag2specReady=!0}),a.report=d.reportModel;var i=['<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><title>'+d.reportModel.title+"</title><script>"+g.toString()+'</script><link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css" /><link rel="stylesheet" href="report.css" /></head><body><div class="container reporter-view">',"</div></body></html>"];a.$on("reportReady",function(a,c){var d=i[0]+c.html()+i[1];h=f.getBlob(d,"text/html;charset=utf-8"),b.find("#html_download_link").attr("href",f.getBlobUrl(h))}),a.downloadJsonStart=function(){f.saveBlobIE(),e.setPrestineState()},a.saveHtmlBlobIE=function(){h&&f.saveBlobIE(h,a.exportHtmlFile)},a.exportHtmlFile=f.getFileName("html"),a.exportJsonUrl=f.getBlobUrl(),a.exportJsonFile=f.getFileName()}]),angular.module("wcagReporter").controller("OpenCtrl",["$scope","reportStorage","evalLoader","$rootScope",function(a,b,c,d){function e(a,b){b.posted=!0,b.failure=!1,a.then(function(){b.posted=!1,d.setEvalLocation()},function(a){b.posted=!1,a.message?b.failure=a.message:b.failure=a})}a.postSettings=b.settings,a.fileFeedback={posted:!1,failures:!1},a.evalFile="",a.urlFeedback={posted:!1,failures:!1},a.loadFile=function(b){var d=c.openFromFile(b);e(d,a.fileFeedback)},a.loadUrl=function(){e(c.openFromUrl(a.postSettings.url),a.urlFeedback)},a.updateSettings=function(){b.updateSettings()}}]),angular.module("wcagReporter").controller("SaveCtrl",["$scope","wcagReporterExport","appState",function(a,b,c){a.exportUrl=b.getBlobUrl(),a.exportFile=b.getFileName(),a.postSettings=b.storage.settings,a.posted=!1,a.failure=!1,a.success=!1,a.postJson=function(){a.posted=!0,a.failure=!1,b.saveToUrl().then(function(){a.success=!0,a.posted=!1},function(b){a.failure=b?b:!0,a.posted=!1})},a.downloadStart=function(){b.saveBlobIE(),c.setPrestineState()},a.updateSettings=function(){b.storage.updateSettings()}}]),angular.module("wcagReporter").controller("ReportScoreCtrl",["$scope","wcag2spec","evalAuditModel",function(a,b,c){a.principles=b.getPrinciples();var d={"earl:passed":0,"earl:failed":0,"earl:inapplicable":0,"earl:untested":0,"earl:cantTell":0,level_a:{pass:0,total:0},level_aa:{pass:0,total:0},level_aaa:{pass:0,total:0}};a.totals=d,a.getScores=function(){return b.getPrinciples().map(function(b){var e={name:b.num+". "+b.handle,"earl:passed":0,"earl:failed":0,"earl:inapplicable":0,"earl:untested":0,"earl:cantTell":0,tested:0,level_a:{pass:0,total:0},level_aa:{pass:0,total:0},level_aaa:{pass:0,total:0}};return b.guidelines.reduce(function(a,b){return a.push.apply(a,b.successcriteria),a},[]).forEach(function(b){var f=c.getCritAssert(b.id);if(f){var g=f.result.outcome,h=b.level.replace("wai:WCAG2","").replace("-Conformance","").toLowerCase();e[g]+=1,a.totals[g]+=1,("earl:passed"===g||"earl:inapplicable"===g)&&(e["level_"+h].pass+=1,d["level_"+h].pass+=1),"earl:untested"!==g&&(e.tested+=1,e["level_"+h].total+=1,d["level_"+h].total+=1)}}),e})},a.scores=a.getScores(),a.$on("wcag2spec:langChange",function(){a.scores=a.getScores()})}]),angular.module("wcagReporter").controller("ReportFindingsCtrl",["$scope","wcag2spec","evalAuditModel","evalScopeModel","CriterionAssert",function(a,b,c,d,e){b.isLoaded()?a.principles=b.getPrinciples():(a.principles=[],b.onLangChange(function(){a.principles=b.getPrinciples()})),a.auditModel=c,a.critOpt={editable:!1,collapsed:!1,showallpages:!1,hideCollapseBtn:!0},a.getCritAssert=c.getCritAssert,a.shouldCritRender=function(b){if(d.matchConformTarget(b.level))return!0;var c=a.getCritAssert(b.id);return e.isDefined(c)}}]);