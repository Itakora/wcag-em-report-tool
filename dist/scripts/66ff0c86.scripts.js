"use strict";angular.module("wcagReporter",["ngResource","ngSanitize","ngRoute","ngAnimate","pascalprecht.translate","720kb.tooltips","ui.bootstrap","wert-templates"]).config(["$routeProvider","$compileProvider",function(a,b){b.aHrefSanitizationWhitelist(/^\s*(https?|data|blob):/),a.when("/",{templateUrl:"views/start.html",controller:"StartCtrl"}).when("/evaluation/scope",{templateUrl:"views/evaluation/scope.html",controller:"EvalScopeCtrl"}).when("/evaluation/explore",{templateUrl:"views/evaluation/explore.html",controller:"EvalExploreCtrl"}).when("/evaluation/sample",{templateUrl:"views/evaluation/sample.html",controller:"EvalSampleCtrl"}).when("/evaluation/audit",{templateUrl:"views/evaluation/audit.html",controller:"EvalAuditCtrl"}).when("/evaluation/report",{templateUrl:"views/evaluation/report.html",controller:"EvalReportCtrl"}).when("/report",{templateUrl:"views/report.html",controller:"ReportCtrl"}).when("/open",{templateUrl:"views/open.html",controller:"OpenCtrl"}).when("/save",{templateUrl:"views/save.html",controller:"SaveCtrl"}).otherwise({redirectTo:"/"})}]).config(["$translateProvider","wcag20specProvider",function(a,b){var c=jQuery('*[ng-app="wcagReporter"]').attr("lang")||"en";c=c.substr(0,2),a.useSanitizeValueStrategy(null),a.useStaticFilesLoader({prefix:"locale/",suffix:".json"}),b.setSpecPath("wcag20spec/wcag2-${lang}.json"),b.loadLanguage(c),a.preferredLanguage(c)}]).config(["tooltipsConfigProvider",function(a){a.options({speed:"fast",lazy:!1,showTrigger:"mouseover focus",hideTrigger:"mouseout blur"})}]),angular.module("wcagReporter").run(["$rootScope","$document","$rootElement","evalScopeModel",function(a,b,c,d){var e,f=b.find("title"),g=f.text().trim();g&&(g=f.text()+", "),c.focusH1=function(){var a=c.find("h1:first()").attr({tabindex:-1,role:"heading"});setTimeout(function(){a.focus()},10)},a.setTitle=function(b){var c="";return d.website&&d.website.title&&(c=d.website.title+" - "),f.text(g+c+b),e&&(e=!1,setTimeout(a.focusH1,750)),b},a.$on("$routeChangeSuccess",function(){e=void 0!==e,document.activeElement&&document.activeElement.blur()})}]).run(["$rootScope","translateFilter","appState","$location","$rootElement",function(a,b,c,d,e){a.translate=b,a.rootHide={},a.$on("$translateChangeSuccess",function(b,c){e.attr("lang",c.language),a.lang=c.language}),c.init(),a.setEvalLocation=function(){c.setDirtyState(),d.path("/evaluation/scope")},a.support={hasSupport:c.hasBrowserSupport(),hideMessage:!1}}]).run(["$rootElement","wcagReporterExport","showSave","appState",function(a,b,c,d){c&&a.on("keydown",function(a){83===a.keyCode&&(a.ctrlKey||a.metaKey)&&(c(b.getString(),b.getFileName(),"application/json"),d.setPrestineState(),a.preventDefault())});var e=new RegExp("/"+window.location.host+"/");a.on("click","a[href]:not(.local)",function(a){e.test(this.href)&&"javascript:"!==this.href.substr(0,11)||(a.preventDefault(),a.stopPropagation(),window.open(this.href,"_blank"))})}]).run(["wcagReporterImport","wcagReporterExport","$rootElement",function(a,b,c){b.storage.init({autosave:"string"==typeof c.attr("autosave"),url:c.attr("url"),saveDelay:c.attr("save-delay")||1500}),c.attr("url")&&a.getFromUrl()}]),angular.module("wcagReporter").factory("directivePlugin",function(){var a=function(a){var b=a.link||function(){};return a.plugins||(a.plugins=[]),a.link=function(){var c=arguments;b.apply(void 0,c),a.plugins.forEach(function(a){a.link&&a.link.apply(void 0,c)})},a};return a}),angular.module("wcagReporter").value("evalContext",{"@vocab":"http://www.w3.org/TR/WCAG-EM/#",wcag20:"http://www.w3.org/TR/WCAG20/#",earl:"http://www.w3.org/ns/earl#",dct:"http://purl.org/dc/terms/",reporter:"https://github.com/w3c/wcag-em-report-tool/blob/master/dataformat.md#",conformanceTarget:{id:"step1b",type:"id"},evaluationScope:{id:"step1"},accessibilitySupportBaseline:{id:"step1c"},additionalEvalRequirement:{id:"step1d"},siteScope:{id:"step1a"},commonPages:{id:"step2a"},essentialFunctionality:{id:"step2b"},pageTypeVariety:{id:"step2c"},otherRelevantPages:{id:"step2e"},structuredSample:{id:"step3a"},randomSample:{id:"step3b"},specifics:{id:"step5b"},auditResult:{id:"step4"},outcome:{type:"id"},subject:{type:"id"},assertedBy:{type:"id"},testRequirement:{type:"id"},creator:{type:"id"},handle:"reporter:handle",description:"reporter:description",tested:"reporter:tested",id:"@id",type:"@type",title:"dct:title",hasPart:"dct:hasPart",specs:"@id",reliedUponTechnology:"wcag20:reliedupondef"}),angular.module("wcagReporter").constant("knownTech",[{title:"HTML5",id:"http://www.w3.org/TR/html5/"},{title:"XHTML 1.0",id:"http://www.w3.org/TR/xhtml1/"},{title:"HTML 4.01",id:"http://www.w3.org/TR/html401/"},{title:"CSS",id:"http://www.w3.org/Style/CSS/specs/"},{title:"WAI-ARIA",id:"http://www.w3.org/TR/wai-aria/"},{title:"ECMAScript 3",id:"http://www.ecma-international.org/publications/standards/Ecma-327.htm"},{title:"ECMAScript 5",id:"http://www.ecma-international.org/publications/standards/Ecma-262.htm"},{title:"DOM",id:"http://www.w3.org/DOM/"},{title:"Flash",id:"http://get.adobe.com/nl/flashplayer/"},{title:"Silverlight",id:"http://www.microsoft.com/silverlight/"},{title:"OOXML",id:"http://www.ecma-international.org/publications/standards/Ecma-376.htm"},{title:"ODF 1.2",id:"https://www.oasis-open.org/standards#opendocumentv1.2"},{title:"SVG",id:"http://www.w3.org/TR/SVG/"}]),angular.module("wcagReporter").service("reportStorage",["$http","$rootScope","appState","$timeout",function(a,b,c,d){function e(){return j.url?void(g=d(function a(){f.exportModel.saveToUrl().then(function(){i=0},function(){i+=1,j.autosave&&(g=d(a,j.saveDelay*i,0,!1))})},j.saveDelay,0,!1)):void(j.autosave=!1)}var f,g,h,i=0,j={url:void 0,revisionId:void 0,autosave:!1,saveDelay:3e3};return b.$on("appstate:prestine",function(){g&&(d.cancel(g),g=void 0)}),b.$on("appstate:dirty",function(){j.autosave&&void 0===g&&e()}),f={settings:j,exportModel:void 0,init:function(a){f.updateSettings(a)},updateSettings:function(a){a&&angular.extend(j,a),j.autosave&&h?h.then(e):j.autosave&&e()},post:function(b){return j.revisionId&&(b._rev=j.revisionId),a.put(j.url,b,{},{withCredentials:!0}).then(function(a){return a&&a.data&&a.data.rev&&(j.revisionId=a.data.rev),c.setPrestineState(),a.data})},get:function(){return d.cancel(g),h=a.get(j.url,{},{withCredentials:!0}).then(function(a){return a.data._rev&&(j.revisionId=a.data._rev),c.setPrestineState(),a.data})}}}]),angular.module("wcagReporter").service("evalLoader",["evalWindow","appState","fileReader","wcagReporterImport","$q",function(a,b,c,d,e){function f(c){var d;return function(){function f(a){h.reject(a),d.abort()}var g=c.apply(null,arguments),h=e.defer();return d=b.empty?a:a.openEmptyWindow(),g.then(function(a){try{d.loadJson(a),b.setDirtyState(),h.resolve()}catch(c){f(c)}},f),h.promise}}return{openFromFile:f(function(a){return c.readAsText(a)}),openFromUrl:f(function(){return d.getFromUrl()})}}]),angular.module("wcagReporter").service("evalWindow",["$http","wcagReporterImport","$rootScope",function(a,b,c){function d(){}function e(a){f.loadJson(a),c.setEvalLocation()}var f,g="waitingForEvaluation",h="loadEvaluationData",i="evaluateDataWhenReady";return d.prototype={openEmptyWindow:function(){var a=new d,b=window.open(window.location.href,"_blank");return b[g]=!0,a.abort=function(){b.close()},a.loadJson=function(a){b[h]?b[h](a):b[i]=a},a},loadJson:function(a){b.fromJson(a)},abort:angular.noop},f=new d,window[g]&&(window[g]=void 0,window[i]?e(window[i]):window[h]=e),f}]),function(a){var b=function(a,b){var c=function(a,b,c){return function(){c.$apply(function(){b.resolve(a.result)})}},d=function(a,b,c){return function(){c.$apply(function(){b.reject(a.result)})}},e=function(a,b){return function(a){b.$broadcast("fileProgress",{total:a.total,loaded:a.loaded})}},f=function(a,b){var f=new FileReader;return f.onload=c(f,a,b),f.onerror=d(f,a,b),f.onprogress=e(f,b),f},g=function(c,d){d=d||b;var e=a.defer(),g=f(e,d);return d.$evalAsync(function(){try{g.readAsText(c)}catch(a){e.reject(a)}}),e.promise},h=function(c,d){d=d||b;var e=a.defer(),g=f(e,d);return d.$evalAsync(function(){try{g.readAsDataURL(c)}catch(a){e.reject(a)}}),e.promise};return{readAsDataUrl:h,readAsText:g}};a.factory("fileReader",["$q","$rootScope",b])}(angular.module("wcagReporter")),angular.module("wcagReporter").service("showSave",function(){var a,b="application/octet-stream",c="download"in document.createElement("a"),d=window.Blob,e=window.URL||window.webkitURL||window.mozURL||window.msURL;navigator.saveBlob=navigator.saveBlob||navigator.msSaveBlob||navigator.mozSaveBlob||navigator.webkitSaveBlob,window.saveAs=window.saveAs||window.webkitSaveAs||window.mozSaveAs||window.msSaveAs;var f={"image/jpeg":!0,"image/png":!0,"image/gif":!0,"image/svg+xml":!0,"image/bmp":!0,"image/x-windows-bmp":!0,"image/webp":!0,"audio/wav":!0,"audio/mpeg":!0,"audio/webm":!0,"audio/ogg":!0,"video/mpeg":!0,"video/webm":!0,"video/ogg":!0,"text/plain":!0,"text/html":!0,"text/xml":!0,"application/xhtml+xml":!0,"application/json":!0};return d&&(window.saveAs||navigator.saveBlob)?a=function(a,c,e){var f=new d([a],{type:e||b});c=c||"Download.bin",console.log(1,c),window.saveAs?window.saveAs(f,c):navigator.saveBlob(f,c)}:d&&e?a=function(a,g,h){var i,j;if(c){j=new d([a],{type:h||b}),i=e.createObjectURL(j);var k=document.createElement("a");k.setAttribute("href",i),k.setAttribute("download",g||"Download.bin");var l=document.createEvent("MouseEvents");l.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,0,null),k.dispatchEvent(l)}else f[h.split(";")[0]]===!0&&(h=b),j=new d([a],{type:h||b}),i=e.createObjectURL(j),window.open(i,"_blank","");setTimeout(function(){e.revokeObjectURL(i)},250)}:/\bMSIE\b/.test(navigator.userAgent)||(a=function(a,c,d){d||(d=b),f[d.split(";")[0]]===!0&&(d=b),console.log(3,c),window.open("data:"+d+","+encodeURIComponent(a),"_blank","")}),a}),angular.module("wcagReporter").directive("criterionBody",["directivePlugin","evalSampleModel","selectedCasesOnlyFilter",function(a,b,c){function d(a){var d=b.getFilledPages(),e=a.criterion.getSinglePageAsserts();return a.opt.editable?c(e).sort(function(a,b){return d.indexOf(a.subject[0])-d.indexOf(b.subject[0])}):e.filter(function(a){return a.isDefined()}).sort(function(a,b){return d.indexOf(a.subject[0])-d.indexOf(b.subject[0])})}return a({restrict:"E",replace:!0,transclude:!0,scope:{criterion:"=assert",opt:"=options"},controller:["$scope",function(a){a.opt.editable&&a.criterion.setCaseForEachPage(),a.$on("audit:sample-change",function(){a.multiPageAsserts=a.criterion.getMultiPageAsserts(),console.log("sort"),a.singlePageAsserts=d(a)})}],link:function(a){a.showBody=function(){return a.multiPageAsserts.length>0||a.singlePageAsserts.length>0||a.opt.editable},a.multiPageAsserts=a.criterion.getMultiPageAsserts(),a.singlePageAsserts=d(a),a.hasMultipage=!1,a.addMultiPage=function(){a.criterion.addTestCaseAssertion({multiPage:!0,subject:b.getSelectedPages()}),a.multiPageAsserts=a.criterion.getMultiPageAsserts()}},templateUrl:"views/directives/criterion/criterionBody.html"})}]),angular.module("wcagReporter").directive("earlAssert",["$filter","directivePlugin",function(a,b){var c=["earl:untested","earl:passed","earl:failed","earl:inapplicable","earl:cantTell"].map(function(b){return{id:b,name:a("rdfToLabel")(b)}});return b({restrict:"E",replace:!0,transclude:!0,scope:{result:"=value",opt:"=options"},link:function(b){b.outcomes=c,b.getStaticHtmlResult=function(b){return b=(""+b).trim()||"–","<p><strong>"+a("translate")("HTML_REPORT.LABEL_DESCR")+":</strong> "+a("txtToHtml")(b).substr(3)},b.htmlResult=b.getStaticHtmlResult(b.result.description)},templateUrl:"views/directives/criterion/earlAssert.html"})}]),angular.module("wcagReporter").directive("macroResults",["directivePlugin",function(a){return a({restrict:"E",replace:!0,scope:{criterion:"=value",asserts:"=",opt:"=options"},link:function(a){a.removeAssert=function(b){var c=a.criterion.hasPart.indexOf(b);c>=0&&a.criterion.hasPart.splice(c,1),c=a.asserts.indexOf(b),c>=0&&a.asserts.splice(c,1)},a.transferMacroData=function(b){a.criterion.transferMacroData(b),a.removeAssert(b)},a.getAllHandles=function(a){return a.subject.map(function(a){return a.displayHandle()}).join(", ")}},templateUrl:"views/directives/criterion/macroResults.html"})}]),angular.module("wcagReporter").directive("pageResults",["directivePlugin",function(a){return a({restrict:"E",replace:!0,scope:{criterion:"=value",asserts:"=",opt:"=options"},link:function(a){a.createMacro=function(b){a.criterion.addTestCaseAssertion({result:{description:b.result.description,outcome:b.result.outcome},multiPage:!0})}},templateUrl:"views/directives/criterion/pageResults.html"})}]),angular.module("wcagReporter").directive("pageSelect",["directivePlugin","evalSampleModel",function(a,b){var c;return a({restrict:"E",replace:!0,scope:{pages:"="},controller:["$scope",function(a){a.updateSampleList=function(){a.unselectedPages=c.filter(function(b){return-1===a.pages.indexOf(b)})},a.removePage=function(b){var c=a.pages.indexOf(b);c>=0&&(a.pages.splice(c,1),a.updateSampleList())},a.addPageToAssert=function(){var c=b.getPageByHandle(a.newPage);c&&-1===a.pages.indexOf(c)&&(a.unselectedPages.splice(a.unselectedPages.indexOf(c),1),a.pages.push(c),a.newPage="")},c=b.getPages(),a.updateSampleList()}],templateUrl:"views/directives/criterion/pageSelect.html"})}]),angular.module("wcagReporter").directive("resultDescription",["directivePlugin",function(a){return a({restrict:"E",replace:!0,scope:{value:"=",id:"@"},templateUrl:"views/directives/criterion/resultDescription.html"})}]),angular.module("wcagReporter").directive("infoButton",["directivePlugin",function(a){return a({restrict:"E",scope:{label:"@",target:"@"},link:function(a,b){var c;b.on("click",function(){c||(c="undefined"==typeof a.target?b.next():angular.element("#"+a.target)),c.toggle(200,function(){c.focus()})})},replace:!0,template:'<a class="info-icon" href=""><span class="glyphicon glyphicon-info-sign"></span><span class="sr-only">{{label}}</span></a> '})}]),angular.module("wcagReporter").directive("infoField",["directivePlugin","$document",function(a,b){function c(a){var c=":input:visible, a[href]:visible",d=b.find(c);return a=angular.element(a).closest(".alert-info").find(c).last(),d[d.index(a)+1]}return a({restrict:"E",scope:{ref:"@",button:"@",exitto:"@"},link:function(a,b){b.hide(0),a.close=function(d){var e;("keyup"!==d.type||13===d.keyCode||27===d.keyCode)&&(a.exitto&&(e=angular.element("#"+a.exitto)),e&&0!==e.length||(e=c(d.target)),e.focus(),b.hide(200))}},replace:!0,transclude:!0,templateUrl:"views/directives/evaluate/infoField.html"})}]),angular.module("wcagReporter").directive("inputPages",["directivePlugin","$timeout","Page",function(a,b,c){return a({restrict:"E",replace:!0,scope:{pages:"=",addPage:"&",removePage:"&"},link:function(a){var d=a.addPage(),e=a.removePage();a.addPage=function(a){var c=angular.element(a.delegateTarget);d(),b(function(){var a=c.prev().find("input");a[a.length-2].select()},100)},a.prependProtocol=c.prependProtocol,a.removePage=function(a,c){e(a),b(function(){angular.element(c.delegateTarget).closest("fieldset").parent().children().last().focus()})}},templateUrl:"views/directives/evaluate/inputPages.html"})}]),angular.module("wcagReporter").directive("techSelect",function(){function a(a,c,d){b.forEach(function(b){a[c]===b[c]&&(a[d]=b[d])})}var b=[{title:"HTML5",specs:"http://www.w3.org/TR/html5/"},{title:"CSS",specs:"http://www.w3.org/Style/CSS/specs/"},{title:"HTML 4.01",specs:"http://www.w3.org/TR/html401/"}];return{restrict:"E",replace:!0,scope:{selected:"="},link:function(c){c.technolgies=b,c.updateTitle=function(b){a(b,"specs","title")},c.updateSpec=function(b){a(b,"title","specs")}},templateUrl:"views/directives/evaluate/techSelect.html"}}),angular.module("wcagReporter").directive("iconButton",["directivePlugin",function(a){return a({restrict:"E",replace:!0,scope:{label:"=",icon:"=",click:"&"},templateUrl:"views/directives/evaluate/iconButton.html"})}]),angular.module("wcagReporter").directive("buttonCollapse",["directivePlugin",function(a){return a({restrict:"E",replace:!0,transclude:!0,scope:{obj:"=target",prop:"@property"},link:function(a,b,c){void 0!==c.collapsed&&void 0===a.obj[a.prop]&&(a.obj[a.prop]=!0)},templateUrl:"views/directives/buttonCollapse.html"})}]),angular.module("wcagReporter").directive("fullReport",["directivePlugin","$interval",function(a,b){function c(a){return function(b){return 0===a.find(b).length}}return a({restrict:"E",replace:!0,link:function(a,d){var e=[".panel-heading",".sample_narrow",".score-total"],f=b(function(){e=e.filter(c(d)),0===e.length&&(a.$emit("reportReady",d),b.cancel(f))},200)},templateUrl:"views/directives/fullReport.html"})}]),angular.module("wcagReporter").directive("successCriterion",["directivePlugin","$rootScope",function(a,b){var c={"earl:untested":"untested","earl:passed":"passed","earl:failed":"failed","earl:inapplicable":"inapplicable","earl:cantTell":"canttell"};return a({restrict:"E",replace:!0,scope:{assert:"=assertion",spec:"=requirement",opt:"=options"},link:function(a){a.rootHide=b.rootHide,a.critHide=a.spec.id+"-cb",a.getClassName=function(a){return c[a]}},templateUrl:"views/directives/successCriterion.html"})}]),angular.module("wcagReporter").directive("autoResize",["directivePlugin",function(a){return a({restrict:"A",link:function(a,b){a.$evalAsync(function(){angular.element(b).textareaAutoSize()})}})}]),angular.module("wcagReporter").directive("shyPlaceholder",["directivePlugin",function(a){var b="placeholder";return a({restrict:"A",scope:{shyPlaceholder:"="},compile:function(a,c){return function(a,d){var e=a.$eval(c.shyPlaceholder);d.attr(b,e).bind({focus:d.attr.bind(d,b,""),blur:d.attr.bind(d,b,e)})}}})}]),angular.module("wcagReporter").filter("makeId",function(){return function(a){return a.toLowerCase().replace(/\s+/g,"_").replace(/[^a-z0-9_]/g,"")}}),angular.module("wcagReporter").filter("selectedCasesOnly",function(){function a(a){for(var b=0;b<a.subject.length;b++){var c=a.subject[b];if(c.selected&&(c.handle||c.description))return!0}return!1}return function(b){return b?b.filter(a):void 0}}),angular.module("wcagReporter").filter("rdfToLabel",["$filter",function(a){var b,c={"earl:passed":"PASSED","earl:failed":"FAILED","earl:cantTell":"CANT_TELL","earl:inapplicable":"NOT_PRESENT","earl:untested":"NOT_CHECKED",A:"LEVEL_A",AA:"LEVEL_AA",AAA:"LEVEL_AAA","wcag20:level_a":"LEVEL_A","wcag20:level_aa":"LEVEL_AA","wcag20:level_aaa":"LEVEL_AAA"};return b=function(b){return a("translate")("EARL."+c[b])},b.keymap=c,b}]),angular.module("wcagReporter").filter("txtToHtml",["$filter",function(a){return function(b){return"string"!=typeof b?"":b.split("\n").reduce(function(b,c){return""===c.trim()?b+"</p><p>":(c=a("linky")(c,"_blank"),b+("<p>"===b.substr(-3)?"":"<br />")+c)},"<p>")+"</p>"}}]),angular.module("wcagReporter").service("appState",["$rootScope","$document","translateFilter",function(a,b,c){function d(){return f}var e,f=c("COMMON.WARNING_BEFORE_UNLOAD"),g=window.jQuery(window);return e={pristine:!0,empty:!0,currentStateIndex:0,maxStateIndex:0,stateList:[{name:"start",route:"/",copmlete:!1},{name:"scope",route:"/evaluation/scope",copmlete:!1},{name:"explore",route:"/evaluation/explore",copmlete:!1},{name:"sample",route:"/evaluation/sample",copmlete:!1},{name:"audit",route:"/evaluation/audit",copmlete:!1},{name:"report",route:"/evaluation/report",copmlete:!1},{name:"export",route:"/report",copmlete:!1}]},e.moveToState=function(a){var b,c;for(b=0;b<this.stateList.length;b+=1)if(e.stateList[b].name===a){c=b;break}return e.currentStateIndex=c,e.maxStateIndex<c&&(e.maxStateIndex=c),e},e.getPreviousState=function(){return e.stateList[e.currentStateIndex-1]},e.getNextState=function(){return e.stateList[e.currentStateIndex+1]},e.setPrestineState=function(){e.pristine=!0,g.off("beforeunload",d),b.one("change","input[type=text], textarea, select",e.setDirtyState),a.$emit("appstate:prestine")},e.setDirtyState=function(){e.pristine&&(a.$emit("appstate:dirty"),g.on("beforeunload",d)),e.pristine=!1,e.empty=!1},e.init=function(){b.one("change","input[type=text], textarea, select",e.setDirtyState)},e.hasBrowserSupport=function(){var a=!0;return window.Blob||(console.error("Blob not supported in this browser."),a=!1),window.FileReader||(console.error("FileReader not supported in this browser."),a=!1),window.navigator.msSaveOrOpenBlob||(window.URL||window.webkitURL)&&(window.URL||window.webkitURL).createObjectURL||(console.error("msSaveOrOpenBlob or createObjectURL not supported in this browser."),a=!1),a},e}]),angular.module("wcagReporter").provider("wcag20spec",function(){function a(a){return function(b,c){return angular.isArray(b)||(b=b[a]),b.concat(c[a])}}var b,c,d,e,f=angular.noop,g={},h={},i={addSpec:function(a,b){a=a.toLowerCase(),h[a]=b,e||i.useLanguage(a)},loadLanguage:function(a){if(a=a.toLowerCase(),"string"!=typeof b)throw new Error("specPath must be defined first");if(h[a])return i.useLanguage(a);var c=b.replace("${lang}",a.toLowerCase());$.getJSON(c).done(function(b){h[a]=b,i.useLanguage(a),f("wcag20spec:load",a)}).fail(console.error.bind(console))},useLanguage:function(b){if(b=b.toLowerCase(),!h[b])throw new Error("Spec for lang "+b+" not defined.");e=h[b],c=e.principles.reduce(a("guidelines"),[]),d=c.reduce(a("successcriteria"),[]),d.forEach(function(a){if(-1!==["A","AA","AAA"].indexOf(a.level)){var b="wcag20:level_"+a.level;a.id=a.id.replace("WCAG2:","wcag20:"),a.level=b.toLowerCase(),g[a.id]=a}}),f("wcag20spec:langChange",b)},getGuidelines:function(){return c},getCriteria:function(){return d},getCriterion:function(a){return g[a]},getPrinciples:function(){return e.principles}};this.setSpecPath=function(a){b=a},this.loadLanguage=i.loadLanguage,this.$get=["$rootScope",function(a){return f=function(b,c,d){a.$broadcast(b,c,d)},angular.extend({},i)}]}),angular.module("wcagReporter").service("CriterionAssert",["evalSampleModel","TestCaseAssert","wcag20spec","currentUser",function(a,b,c,d){function e(a){var b=this;for(var c in e.prototype)this.hasOwnProperty(c)||(this[c]=e.prototype[c]);this.testRequirement=a,this.hasPart=[],this.result={outcome:"earl:untested",description:""},this.getSinglePageAsserts=function(){return b.hasPart.filter(function(a){return a.multiPage!==!0})},this.getMultiPageAsserts=function(){return b.hasPart.filter(function(a){return a.multiPage===!0})},this.addPage=function(a){this.addTestCaseAssertion({subject:[a]})},this.removePage=function(a){var b=this.hasPart;b.map(function(a){return a.subject[0].id});b.forEach(function(c,d){var e=c.subject.indexOf(a);-1!==e&&(c.multiPage?b.subject.splice(e,1):b.splice(d,1))})}}return e.prototype={type:"earl:assertion",testRequirement:void 0,assertedBy:d.id,subject:"_:website",result:void 0,mode:"manual",hasPart:void 0,getSinglePageAsserts:void 0,getMultiPageAsserts:void 0,addTestCaseAssertion:function(a){var c,d=new b;if(d.testcase=this.testRequirement,this.hasPart.push(d),a)for(c in a)"subject"===c?d.setSubject(a.subject):d[c]=a[c]},transferMacroData:function(a){this.getSinglePageAsserts().filter(function(b){return-1!==a.subject.indexOf(b.subject[0])}).forEach(function(b){"string"!=typeof b.result.description&&(b.result.description=""),""===b.result.description.trim()?b.result.description=a.result.description.trim():b.result.description=(a.result.description+"\n\n"+b.result.description).trim(),b.result.outcome=a.result.outcome})},setCaseForEachPage:function(){var b,c=this;b=this.hasPart.filter(function(a){return angular.isArray(a.subject)&&1===a.subject.length}).map(function(a){return a.subject[0]}),a.getPages().filter(function(a){return-1===b.indexOf(a)}).forEach(function(a){c.addTestCaseAssertion({subject:[a]})})},getSpec:function(){return c.getCriterion(this.testRequirement)}},e.isDefined=function(a){var b=a.hasPart.reduce(function(a,b){return a||b.isDefined()?!0:!1},!1);return b||!!a.result.description||"earl:untested"!==a.result.outcome},e}]),angular.module("wcagReporter").service("TestCaseAssert",["evalSampleModel","currentUser",function(a,b){function c(){for(var a in c.prototype)this.hasOwnProperty(a)||(this[a]=c.prototype[a]);this.subject=[],this.result=Object.create(d)}var d={description:"",outcome:"earl:untested"};return c.isDefined=function(a){var b=!1;return a.subject.forEach(function(a){b=b||a.handle||a.description}),(a.result.description||a.result.outcome!==d.outcome)&&b},c.prototype={type:"earl:assertion",assertedBy:b.id,subject:void 0,testCase:void 0,result:void 0,multiPage:!1,mode:"manual",isDefined:function(){return c.isDefined(this)},addNewPage:function(a){this.subject.push(a)},removePage:function(a){this.subject.splice(a,1)},setSubject:function(b){var c=[];this.subject=c,b&&!angular.isArray(b)&&(b=[b]),b.forEach(function(b){"string"==typeof b&&(b=a.getPageById(b)),"object"==typeof b&&c.push(b)})}},c}]),angular.module("wcagReporter").service("Page",["translateFilter",function(a){function b(){}return b.getUrl=function(a){var b=/((https?):\/\/)([\da-z\.-]+)\.([a-z\.]{2,6})([\-\w\d@:%_\+.~#?,&\/\/=]+)/g,c=a.description.match(b);return c?c[0]:void 0},b.prependProtocol=function(a){a.description&&a.description.match(/^([\da-z\.-]+)\.([a-z\.]{2,6})/)&&(a.description="http://"+a.description)},b.openInWindow=function(a,c){c=c||"_blank";var d=b.getUrl(a);d&&window.open(d,c)},b.prototype={type:"webpage",id:"",description:void 0,handle:"",tested:!1,selected:!1,displayHandle:function(){var b=0;return this.handle.trim()?this.handle:"_:struct_"===this.id.substr(0,9)?(b=+this.id.substr(9),a("SAMPLE.STRUCTURED_PAGE")+" "+(b+1)):"_:rand_"===this.id.substr(0,7)?(b=+this.id.substr(7),a("SAMPLE.RANDOM_PAGE")+" "+(b+1)):a("SAMPLE.SAMPLE_PAGE")}},b}]),angular.module("wcagReporter").service("evalScopeModel",function(){var a={conformanceTarget:"wcag20:level_aa",additionalEvalRequirement:"",website:{id:"_:website",title:"",siteScope:""},accessibilitySupportBaseline:""};return a.exportData=function(){return{conformanceTarget:a.conformanceTarget,additionalEvalRequirement:a.additionalEvalRequirement,website:{id:a.website.id,title:a.website.title,siteScope:a.website.siteScope},accessibilitySupportBaseline:a.accessibilitySupportBaseline}},a.conformanceOptions=["wcag20:level_a","wcag20:level_aa","wcag20:level_aaa"],a.validate=function(){return[]},a.matchConformTarget=function(b){return a.conformanceTarget.length>=b.length},Object.preventExtensions(a.website),Object.preventExtensions(a),a}),angular.module("wcagReporter").service("currentUser",function(){return{"@context":{"@vocab":"http://xmlns.com/foaf/spec/#",id:"@id",type:"@type"},id:"_:evaluator",type:"Person",name:""}}),angular.module("wcagReporter").service("evalExploreModel",["knownTech","evalSampleModel",function(a,b){var c={commonPages:[],otherRelevantPages:[],knownTech:a},d=["reliedUponTechnology","essentialFunctionality","pageTypeVariety"];return d.forEach(function(a){c[a]=void 0}),c.reliedUponTechnology=[],c.importData=function(a){angular.isArray(a.reliedUponTechnology)||(a.reliedUponTechnology=[a.reliedUponTechnology]),d.forEach(function(b){a[b]&&(c[b]=a[b])})},c.exportData=function(){var a={};return d.forEach(function(b){a[b]=c[b]}),a},c.validate=function(){return[]},Object.preventExtensions(c),c}]),angular.module("wcagReporter").service("evalSampleModel",["Page",function(a){function b(a){var b,e;return c.isArray(a.webpage)&&0!==a.webpage.length?(b=a===d.randomSample?"_:rand_":"_:struct_",e=a.webpage.map(function(a){return+a.id.substr(b.length)}).sort(function(a,b){return a-b}).pop(),e+1):0}var c=angular,d={},e=[],f=[];return d.structuredSample={webpage:e},d.randomSample={webpage:f},d.removePage=function(a,b){var d;return c.isNumber(b)||(b=a.webpage.indexOf(b)),c.isNumber(b)&&b>=0&&(d=a.webpage.splice(b,1)[0]),d},d.addNewStructuredPage=function(){var c=d.structuredSample,e=new a,f=b(c);return c.webpage.push(e),e.id="_:struct_"+f,e.handle="",e},d.addNewRandomPage=function(){var c=new a,e=b(d.randomSample);return d.randomSample.webpage.push(c),c.id="_:rand_"+e,c.handle="",c},d.addNewPage=function(a){return a===d.randomSample?d.addNewRandomPage():d.addNewStructuredPage()},d.getPageByHandle=function(a){var b;return d.getPages().forEach(function(c){c.handle===a&&(b=c)}),b},d.getPages=function(){return d.structuredSample.webpage.concat(d.randomSample.webpage)},d.getFilledPages=function(){return d.getPages().filter(function(a){return a.description||a.handle})},d.getSelectedPages=function(){return d.getPages().reduce(function(a,b){return b.selected&&a.push(b),a},[])},d.validate=function(){return[]},d.exportData=function(){var a,b=["type","id","description","handle","tested"];return a=[d.structuredSample.webpage,d.randomSample.webpage].map(function(a){return a.map(function(a){var c={};return b.forEach(function(b){c[b]=a[b]}),c})}),{structuredSample:{webpage:a[0]},randomSample:{webpage:a[1]}}},d.importData=function(b){["structuredSample","randomSample"].forEach(function(e){d[e]=b[e],"object"!=typeof b[e]&&(d[e]={}),"undefined"==typeof d[e].webpage?d[e].webpage=[]:c.isArray(d[e].webpage)||(d[e].webpage=[d[e].webpage]),d[e].webpage.forEach(function(b){b.displayHandle=a.prototype.displayHandle})})},d.getPageById=function(a){for(var b=d.getPages(),c=0;c<b.length;c++)if(b[c].id===a)return b[c]},Object.preventExtensions(d),d}]),angular.module("wcagReporter").service("evalAuditModel",["TestCaseAssert","evalScopeModel","wcag20spec","CriterionAssert",function(a,b,c,d){var e,f={};return e={criteria:f,exportData:function(){var b=angular.copy(this.getCriteriaSorted());return b.reduce(function(b,c){return c.hasPart=c.hasPart.filter(function(b){return a.isDefined(b)}),Object.keys(c).forEach(function(a){"function"==typeof c[a]&&delete c[a]}),b.push.apply(b,c.hasPart),b},[]).forEach(function(a){a.subject=a.subject.map(function(a){return a.id})}),b},importData:function(a){a.auditResult&&(angular.isArray(a.auditResult)||(a.auditResult=[a.auditResult]),a.auditResult.forEach(e.addCritAssert))},getCritAssert:function(a){if("object"!=typeof f[a])throw"Unknown criterion of id "+a;return f[a]},getCriteriaSorted:function(){return c.getCriteria().map(function(a){return f[a.id]}).filter(angular.isDefined)},addCritAssert:function(a){var b,c=Object.create(d.prototype);d.apply(c);for(b in a)"hasPart"===b?(angular.isArray(a.hasPart)||(a.hasPart=[a.hasPart]),a.hasPart.forEach(c.addTestCaseAssertion,c)):c[b]=a[b];f[c.testRequirement]=c},addPageForAsserts:function(a){Object.keys(f).forEach(function(b){f[b].addPage(a)})},removePageFromAsserts:function(a){Object.keys(f).forEach(function(b){f[b].removePage(a)})},updateToConformance:function(){c.getCriteria().forEach(function(a){"undefined"==typeof f[a.id]&&e.addCritAssert({testRequirement:a.id})})}}}]),angular.module("wcagReporter").service("evalReportModel",["$filter","currentUser",function(a,b){var c={creator:b,title:"",summary:"",specifics:"",commissioner:""},d=Object.create(c);return c.date=a("date")(new Date,"longDate"),d.exportData=function(){var a=angular.copy(d);return a.creator=a.creator.id,a},d.importData=function(a){Object.keys(c).forEach(function(b){angular.isDefined(a[b])&&(d[b]=a[b])})},d.setDefaultTitle=function(a){d.title||(d.title=a)},d}]),angular.module("wcagReporter").factory("evalModel",["evalScopeModel","evalExploreModel","evalSampleModel","evalAuditModel","evalReportModel","evalContext","currentUser",function(a,b,c,d,e,f,g){var h={id:void 0,context:f,scopeModel:a,exploreModel:b,sampleModel:c,auditModel:d,reportModel:e,otherData:[g]};return h}]),angular.module("wcagReporter").factory("wcagReporterImport",["$rootScope","evalModel","currentUser","reportStorage",function(a,b,c,d){function e(a,b){Object.keys(a).forEach(function(c){"function"!=typeof a[c]&&"undefined"!=typeof b[c]&&(a[c]=b[c])})}function f(a){var d,e=[],f=0,g="http://www.w3.org/TR/WCAG-EM/#evaluation",i="http://xmlns.com/foaf/spec/#Person";return d=function(b,c){e.push(c),e.length===f&&a(e)},function(a){f+=1,a["@type"]&&-1!==a["@type"].indexOf(g)?h.compact(a,b.context,d):a["@type"]&&-1!==a["@type"].indexOf(i)?h.compact(a,c["@context"],d):e.push(a);
}}function g(a){a.evaluationScope&&e(b.scopeModel,a.evaluationScope),b.id=a.id,b.sampleModel.importData(a),b.reportModel.importData(a),b.auditModel.importData(a),b.exploreModel.importData(a),b.otherData=a.otherData}var h=window.jsonld,i={storage:d,fromJson:function(a){i.fromObject(angular.fromJson(a))},getFromUrl:function(){return d.get().then(function(a){return i.fromJson(a),a})},fromObject:function(a){h.expand(a,function(a,b){i.fromExpanded(b)})},fromExpanded:function(b){b.forEach(f(function(b){var d=b.reduce(function(a,b){if("evaluation"===b.type){if("undefined"!=typeof a)throw new Error("Only one evaluation object allowed in JSON data");return b}return a},void 0);if(!d)throw new Error("No evaluation found in data");"string"==typeof d.creator&&0===d.creator.indexOf("_:")&&(c.id=d.creator),d.creator=c;var e=!1;b.forEach(function(a){e||"Person"!==a.type||a.id!==c.id||(angular.extend(c,a),e=!0)}),d.otherData=b.reduce(function(a,b){return b!==d&&b.id!==c.id&&a.push(b),a},[c]),a.$apply(function(){g(d)})}))}};return i}]),angular.module("wcagReporter").factory("wcagReporterExport",["evalModel","reportStorage",function(a,b){function c(){var b={"@context":a.context,type:"evaluation",id:a.id};return b.evaluationScope=a.scopeModel.exportData(),b.auditResult=a.auditModel.exportData(),angular.extend(b,a.reportModel.exportData(),a.sampleModel.exportData(),a.exploreModel.exportData()),b}var d={storage:b,saveToUrl:function(){return b.post(d.getJson())},getJson:function(){return{"@graph":[c()].concat(a.otherData)}},getString:function(){return angular.toJson(d.getJson(),!0)},getBlobUrl:function(a){try{return a=a||d.getBlob(),(window.URL||window.webkitURL).createObjectURL(a)}catch(b){console.error(b)}},saveBlobIE:function(a,b){a=a||d.getBlob(),b=b||d.getFileName(),window.navigator.msSaveOrOpenBlob&&window.navigator.msSaveBlob(a,b)},getBlob:function(a,b){return a=a||d.getString(),b=b||"application/json;charset=utf-8",new Blob([a],{type:b})},getFileName:function(b){var c=a.scopeModel.website.title+" evaluation report";return b=b||"json",c=c.trim(),c.replace(/(^\-+|[^a-zA-Z0-9\/_| -]+|\-+$)/g,"").toLowerCase().replace(/[\/_| -]+/g,"-")+"."+b}};return b.exportModel=d,d}]),angular.module("wcagReporter").controller("NavigationCtrl",["$scope","$translate","wcag20spec","$rootScope",function(a,b,c,d){a.languages=[{code:"en",localName:"English"},{code:"nl",localName:"Nederlands"}],a.currentLang=d.lang,d.$on("$translateChangeSuccess",function(b,c){a.currentLang=c.language.toLowerCase()}),a.changeLanguage=function(a){b.use(a),c.loadLanguage(a)}}]),angular.module("wcagReporter").controller("StartCtrl",["$scope","$location","appState","$timeout","$rootScope",function(a,b,c,d,e){a.state=c.moveToState("start"),"undefined"==typeof e.rootHide.start1&&(a.initial="hidden",d(function(){a.initial=""},500),d(function(){e.rootHide.start1=!1},700)),a.nextStep=function(){b.path("/evaluation/scope")},a.nextStepName="STEP_SCOPE"}]),angular.module("wcagReporter").controller("StepButtonsCtrl",["$scope","$location","appState",function(a,b,c){var d=c.getPreviousState(),e=c.getNextState();e&&(a.nextStep=function(){b.path(e.route)},a.nextStepName="STEP_"+e.name.toUpperCase()),d&&(a.previousStep=function(){b.path(d.route)},a.previousStepName="STEP_"+d.name.toUpperCase())}]),angular.module("wcagReporter").controller("EvalScopeCtrl",["$scope","appState","evalScopeModel","evalReportModel","$filter",function(a,b,c,d,e){a.state=b.moveToState("scope"),a.scopeModel=c,a.conformanceOptions=c.conformanceOptions.reduce(function(a,b){return a[b]=e("rdfToLabel")(b),a},{}),a.$on("$routeChangeStart",function(){if(c.website.title){var a=e("translate"),b=a("REPORT.TITLE_PREFIX")+" "+c.website.title;d.setDefaultTitle(b)}})}]),angular.module("wcagReporter").controller("EvalExploreCtrl",["$scope","appState","$timeout","evalExploreModel",function(a,b,c,d){a.state=b.moveToState("explore"),a.exploreModel=d,a.updateSpec=function(a){e[a.title]&&(a.id=e[a.title])},a.knownTech=angular.copy(d.knownTech),a.otherTech=[],d.reliedUponTechnology.forEach(function(b){var c=a.knownTech.reduce(function(a,c,d){return c.id===b.id&&c.title===b.title?d:a},-1);-1!==c?a.knownTech[c].checked=!0:a.otherTech.push(b)}),0===a.otherTech.length?a.otherTech.push({}):a.rootHide.OtherTech=a.rootHide.OtherTech||!0,a.changeTech=function(a){a.checked?d.reliedUponTechnology.push({title:a.title,id:a.id}):d.reliedUponTechnology=d.reliedUponTechnology.filter(function(b){return b.title!==a.title&&b.id!==a.id})},a.updateOtherTech=function(a){var b=d.reliedUponTechnology.indexOf(a),c=!a.title&&!a.id;-1!==b||c?-1!==b&&c&&d.reliedUponTechnology.splice(b,1):d.reliedUponTechnology.push(a)},a.addTechnology=function(b){if(a.otherTech.push({}),b){var d=angular.element(b.delegateTarget);c(function(){var a=d.prev().find("input");a[a.length-2].select()},100)}},a.removeTechnology=function(b,e){var f=a.otherTech[b],g=d.reliedUponTechnology.indexOf(f);d.reliedUponTechnology.splice(g,1),a.otherTech.splice(b,1),e&&c(function(){angular.element(e.delegateTarget).closest("fieldset").parent().children().last().focus()})};var e={};a.knownTech.forEach(function(a){e[a.title]=a.id})}]),angular.module("wcagReporter").controller("EvalSampleCtrl",["$scope","appState","evalExploreModel","evalSampleModel","evalAuditModel",function(a,b,c,d,e){if(a.state=b.moveToState("sample"),a.structuredSample=d.structuredSample,a.randomSample=d.randomSample,a.exploreModel=c,e.updateToConformance(),a.structuredSample&&0===a.structuredSample.webpage.length){var f=d.addNewStructuredPage();if(e.addPageForAsserts(f),a.randomSample&&0===a.randomSample.webpage.length){var g=d.addNewRandomPage();e.addPageForAsserts(g)}}a.getPageAdder=function(b){return function(){var c=d.addNewPage(b);e.addPageForAsserts(c);var f=a.structuredSample.webpage.length,g=Math.ceil(f/10);if(a.randomSample.webpage.length+1===g&&f%10===1){var h=d.addNewPage(a.randomSample);e.addPageForAsserts(h)}return c}},a.getPageRemover=function(a){return function(b){var c=d.removePage(a,b);e.removePageFromAsserts(c)}},a.randPageCount=function(){return Math.ceil(a.structuredSample.webpage.length/10)}}]),angular.module("wcagReporter").controller("EvalAuditCtrl",["$scope","appState",function(a,b){a.state=b.moveToState("audit")}]),angular.module("wcagReporter").controller("AuditCriteriaCtrl",["$scope","evalAuditModel","evalScopeModel","wcag20spec","$rootElement","$anchorScroll","$filter","$rootScope",function(a,b,c,d,e,f,g,h){b.updateToConformance(),a.criteria=b.getCriteriaSorted(),a.principles=d.getPrinciples(),a.getCritAssert=b.getCritAssert,a.$on("wcag20spec:langChange",function(){a.principles=d.getPrinciples()}),h.rootHide.criteria?a.critFilter=h.rootHide.criteria:(a.critFilter={level:{},outcome:{}},Object.keys(g("rdfToLabel").keymap).forEach(function(b){"wcag20:"===b.substr(0,7)?a.critFilter.level[b]=c.matchConformTarget(b):"earl:"===b.substr(0,5)&&(a.critFilter.outcome[b]=!0)}),h.rootHide.criteria=a.critFilter),a.isCriterionVisible=function(c){if(a.critFilter.level[c.level]!==!0)return!1;var d=b.getCritAssert(c.id);return"object"!=typeof d||"object"!=typeof d.result?!1:a.critFilter.outcome[d.result.outcome]===!0},a.isGuidelineVisible=function(b){var c=!1;return b.successcriteria.forEach(function(b){(c||a.isCriterionVisible(b))&&(c=!0)}),c},a.isPrincipleVisible=function(b){var c=!1;return b.guidelines.forEach(function(b){(c||a.isGuidelineVisible(b))&&(c=!0)}),c},a.toTop=function(){$("html, body").animate({scrollTop:e.offset().top},200,e.focusH1)}}]),angular.module("wcagReporter").controller("AuditSamplePagesCtrl",["$scope","evalSampleModel","Page","$rootScope",function(a,b,c,d){var e=b.getSelectedPages,f=b.getPages;a.structuredSample=b.structuredSample,a.randomSample=b.randomSample,a.filledPages=function(){return b.getFilledPages()},a.auditSize=e.length,a.anySelect=0!==a.auditSize,a.openSelected=function(){e().forEach(function(a){c.openInWindow(a)})},a.openPage=c.openInWindow,a.changeAll=function(){var b=f();b.forEach(function(b){b.selected=a.anySelect}),a.auditSize=a.anySelect?b.length:0};var g;a.multiSelect=function(c,d){if("input"===d.toElement.nodeName.toLowerCase()){if("undefined"!=typeof g&&d.shiftKey){for(var e=b.getFilledPages(),f=Math.min(g,c),h=Math.max(g,c),i=e[c].selected,j=f;h>=j;j++)e[j].selected=i;a.sampleChange()}g=c}},a.sampleChange=function(){var b=e().length;a.auditSize=b,a.anySelect=b>0,d.$broadcast("audit:sample-change")},a.completePages=function(){e().forEach(function(a){a.tested=!0})},a.uncompletePages=function(){e().forEach(function(a){a.tested=!1})}}]),angular.module("wcagReporter").controller("EvalReportCtrl",["$scope","appState","evalReportModel",function(a,b,c){a.state=b.moveToState("report"),a.reportModel=c}]),angular.module("wcagReporter").controller("ReportCtrl",["$scope","$document","$interval","$timeout","evalModel","wcag20spec","appState","wcagReporterExport",function(a,b,c,d,e,f,g,h){var i;a.state=g.moveToState("export"),a.scope=e.scopeModel,a.explore=e.exploreModel,a.filledPages=function(){return e.sampleModel.getFilledPages()},e.auditModel.updateToConformance(),a.report=e.reportModel;var j=['<!DOCTYPE html><html lang="en"><head><title>'+e.reportModel.title+'</title><link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.0/css/bootstrap.min.css" /><link rel="stylesheet" href="report.css" /></head><body><div class="container reporter-view">',"</div></body></html>"];a.$on("reportReady",function(a,c){var d=j[0]+c.html()+j[1];i=h.getBlob(d,"text/html;charset=utf-8"),b.find("#html_download_link").attr("href",h.getBlobUrl(i))}),a.downloadJsonStart=function(){h.saveBlobIE(),g.setPrestineState()},a.saveHtmlBlobIE=function(){i&&h.saveBlobIE(i,a.exportHtmlFile)},a.exportHtmlFile=h.getFileName("html"),a.exportJsonUrl=h.getBlobUrl(),a.exportJsonFile=h.getFileName()}]),angular.module("wcagReporter").controller("OpenCtrl",["$scope","reportStorage","evalLoader","$rootScope",function(a,b,c,d){function e(a,b){b.posted=!0,b.failure=!1,a.then(function(){b.posted=!1,d.setEvalLocation()},function(a){b.posted=!1,a.message?b.failure=a.message:b.failure=a})}a.postSettings=b.settings,a.fileFeedback={posted:!1,failures:!1},a.evalFile="",a.urlFeedback={posted:!1,failures:!1},a.loadFile=function(b){var d=c.openFromFile(b);e(d,a.fileFeedback)},a.loadUrl=function(){e(c.openFromUrl(a.postSettings.url),a.urlFeedback)},a.updateSettings=function(){b.updateSettings()}}]),angular.module("wcagReporter").controller("SaveCtrl",["$scope","wcagReporterExport","appState",function(a,b,c){a.exportUrl=b.getBlobUrl(),a.exportFile=b.getFileName(),a.postSettings=b.storage.settings,a.posted=!1,a.failure=!1,a.success=!1,a.postJson=function(){a.posted=!0,a.failure=!1,b.saveToUrl().then(function(){a.success=!0,a.posted=!1},function(b){a.failure=b?b:!0,a.posted=!1})},a.downloadStart=function(){b.saveBlobIE(),c.setPrestineState()},a.updateSettings=function(){b.storage.updateSettings()}}]),angular.module("wcagReporter").controller("ReportScoreCtrl",["$scope","wcag20spec","evalAuditModel",function(a,b,c){a.principles=b.getPrinciples();var d={"earl:passed":0,"earl:failed":0,"earl:inapplicable":0,"earl:untested":0,"earl:cantTell":0,level_a:{pass:0,total:0},level_aa:{pass:0,total:0},level_aaa:{pass:0,total:0}};a.totals=d,a.scores=b.getPrinciples().map(function(b){var e={name:b.num+". "+b.handle,"earl:passed":0,"earl:failed":0,"earl:inapplicable":0,"earl:untested":0,"earl:cantTell":0,tested:0,level_a:{pass:0,total:0},level_aa:{pass:0,total:0},level_aaa:{pass:0,total:0}};return b.guidelines.reduce(function(a,b){return a.push.apply(a,b.successcriteria),a},[]).forEach(function(b){console.log(b.level);var f=c.getCritAssert(b.id);if(f){var g=f.result.outcome,h=b.level.replace("wcag20:level_","");e[g]+=1,a.totals[g]+=1,console.log(b.level,"level_"+h,e["level_"+h]),("earl:passed"===g||"earl:inapplicable"===g)&&(e["level_"+h].pass+=1,d["level_"+h].pass+=1),"earl:untested"!==g&&(e.tested+=1,e["level_"+h].total+=1,d["level_"+h].total+=1)}}),e}),console.log(a.totals)}]),angular.module("wcagReporter").controller("ReportFindingsCtrl",["$scope","wcag20spec","evalAuditModel","evalScopeModel","CriterionAssert",function(a,b,c,d,e){c.updateToConformance(),a.principles=b.getPrinciples(),a.auditModel=c,a.critOpt={editable:!1,collapsed:!1,showallpages:!1,hideCollapseBtn:!0},a.getCritAssert=c.getCritAssert,a.shouldCritRender=function(b){if(d.matchConformTarget(b.level))return!0;var c=a.getCritAssert(b.id);return e.isDefined(c)}}]);